{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"atomic-operator This python package is used to execute Atomic Red Team tests (Atomics) across multiple operating system environments. ( What's new? ) Why? atomic-operator enables security professionals to test their detection and defensive capabilities against prescribed techniques defined within atomic-red-team . By utilizing a testing framework such as atomic-operator , you can identify both your defensive capabilities as well as gaps in defensive coverage. Additionally, atomic-operator can be used in many other situations like: Generating alerts to test products Testing EDR and other security tools Identifying way to perform defensive evasion from an adversary perspective Plus more. Features Support local and remote execution of Atomic Red Teams tests on Windows, macOS, and Linux systems Supports running atomic-tests against iaas:aws Can prompt for input arguments but not required Assist with downloading the atomic-red-team repository Can be automated further based on a configuration file A command-line and importable Python package Select specific tests when one or more techniques are specified Plus more Getting Started atomic-operator is a Python-only package hosted on PyPi and works with Python 3.6 and greater. If you are wanting a PowerShell version, please checkout Invoke-AtomicRedTeam . pip install atomic-operator The next steps will guide you through setting up and running atomic-operator . Get Atomics Install / clone Atomic Red Team repository atomic-operator Understand the options availble in atomic-operator Running Test on Command Line or Running Tests within a Script Running Tests via Configuration File Installation You can install atomic-operator on OS X, Linux, or Windows. You can also install it directly from the source. To install, see the commands under the relevant operating system heading, below. Prerequisites The following libraries are required and installed by atomic-operator: pyyaml==5.4.1 fire==0.4.0 requests==2.26.0 attrs==21.2.0 pick==1.2.0 macOS, Linux and Windows: pip install atomic-operator macOS using M1 processor git clone https://github.com/swimlane/atomic-operator.git cd atomic-operator # Satisfy ModuleNotFoundError: No module named 'setuptools_rust' brew install rust pip3 install --upgrade pip pip3 install setuptools_rust # Back to our regularly scheduled programming . . . python setup.py install Installing from source git clone https://github.com/swimlane/atomic-operator.git cd atomic-operator python setup.py install Usage example (command line) You can run atomic-operator from the command line or within your own Python scripts. To use atomic-operator at the command line simply enter the following in your terminal: atomic-operator --help atomic-operator run -- --help Please note that to see details about the run command run atomic-operator run -- --help and NOT atomic-operator run --help Retrieving Atomic Tests In order to use atomic-operator you must have one or more atomic-red-team tests (Atomics) on your local system. atomic-operator provides you with the ability to download the Atomic Red Team repository. You can do so by running the following at the command line: atomic-operator get_atomics # You can specify the destination directory by using the --destination flag atomic-operator get_atomics --destination \"/tmp/some_directory\" Running Tests Locally In order to run a test you must provide some additional properties (and options if desired). The main method to run tests is named run . # This will run ALL tests compatiable with your local operating system atomic-operator run --atomics-path \"/tmp/some_directory/redcanaryco-atomic-red-team-3700624\" You can select individual tests when you provide one or more specific techniques. For example running the following on the command line: atomic-operator run --techniques T1564.001 --select_tests Will prompt the user with a selection list of tests associated with that technique. A user can select one or more tests by using the space bar to highlight the desired test: Select Test(s) for Technique T1564.001 (Hide Artifacts: Hidden Files and Directories) * Create a hidden file in a hidden directory (61a782e5-9a19-40b5-8ba4-69a4b9f3d7be) Mac Hidden file (cddb9098-3b47-4e01-9d3b-6f5f323288a9) Create Windows System File with Attrib (f70974c8-c094-4574-b542-2c545af95a32) Create Windows Hidden File with Attrib (dadb792e-4358-4d8d-9207-b771faa0daa5) Hidden files (3b7015f2-3144-4205-b799-b05580621379) Hide a Directory (b115ecaf-3b24-4ed2-aefe-2fcb9db913d3) Show all hidden files (9a1ec7da-b892-449f-ad68-67066d04380c) Running Tests Remotely In order to run a test remotely you must provide some additional properties (and options if desired). The main method to run tests is named run . # This will run ALL tests compatiable with your local operating system atomic-operator run --atomics-path \"/tmp/some_directory/redcanaryco-atomic-red-team-3700624\" --hosts \"10.32.1.0\" --username \"my_username\" --password \"my_password\" When running commands remotely against Windows hosts you may need to configure PSRemoting. See details here: Windows Remoting Additional parameters You can see additional parameters by running the following command: atomic-operator run -- --help Parameter Name Type Default Description techniques list all One or more defined techniques by attack_technique ID. test_guids list None One or more Atomic test GUIDs. select_tests bool False Select one or more atomic tests to run when a techniques are specified. atomics_path str os.getcwd() The path of Atomic tests. check_prereqs bool False Whether or not to check for prereq dependencies (prereq_comand). get_prereqs bool False Whether or not you want to retrieve prerequisites. cleanup bool False Whether or not you want to run cleanup command(s). copy_source_files bool True Whether or not you want to copy any related source (src, bin, etc.) files to a remote host. command_timeout int 20 Time duration for each command before timeout. debug bool False Whether or not you want to output details about tests being ran. prompt_for_input_args bool False Whether you want to prompt for input arguments for each test. return_atomics bool False Whether or not you want to return atomics instead of running them. config_file str None A path to a conifg_file which is used to automate atomic-operator in environments. config_file_only bool False Whether or not you want to run tests based on the provided config_file only. hosts list None A list of one or more remote hosts to run a test on. username str None Username for authentication of remote connections. password str None Password for authentication of remote connections. ssh_key_path str None Path to a SSH Key for authentication of remote connections. private_key_string str None A private SSH Key string used for authentication of remote connections. verify_ssl bool False Whether or not to verify ssl when connecting over RDP (windows). ssh_port int 22 SSH port for authentication of remote connections. ssh_timeout int 5 SSH timeout for authentication of remote connections. **kwargs dict None If additional flags are passed into the run command then we will attempt to match them with defined inputs within Atomic tests and replace their value with the provided value. You should see a similar output to the following: NAME atomic-operator run - The main method in which we run Atomic Red Team tests. SYNOPSIS atomic-operator run <flags> DESCRIPTION The main method in which we run Atomic Red Team tests. FLAGS --techniques=TECHNIQUES Type: list Default: ['all'] One or more defined techniques by attack_technique ID. Defaults to 'all'. --test_guids=TEST_GUIDS Type: list Default: [] One or more Atomic test GUIDs. Defaults to None. --select_tests=SELECT_TESTS Type: bool Default: False Select one or more tests from provided techniques. Defaults to False. --atomics_path=ATOMICS_PATH Default: '/U... The path of Atomic tests. Defaults to os.getcwd(). --check_prereqs=CHECK_PREREQS Default: False Whether or not to check for prereq dependencies (prereq_comand). Defaults to False. --get_prereqs=GET_PREREQS Default: False Whether or not you want to retrieve prerequisites. Defaults to False. --cleanup=CLEANUP Default: False Whether or not you want to run cleanup command(s). Defaults to False. --copy_source_files=COPY_SOURCE_FILES Default: True Whether or not you want to copy any related source (src, bin, etc.) files to a remote host. Defaults to True. --command_timeout=COMMAND_TIMEOUT Default: 20 Timeout duration for each command. Defaults to 20. --debug=DEBUG Default: False Whether or not you want to output details about tests being ran. Defaults to False. --prompt_for_input_args=PROMPT_FOR_INPUT_ARGS Default: False Whether you want to prompt for input arguments for each test. Defaults to False. --return_atomics=RETURN_ATOMICS Default: False Whether or not you want to return atomics instead of running them. Defaults to False. --config_file=CONFIG_FILE Type: Optional[] Default: None A path to a conifg_file which is used to automate atomic-operator in environments. Default to None. --config_file_only=CONFIG_FILE_ONLY Default: False Whether or not you want to run tests based on the provided config_file only. Defaults to False. --hosts=HOSTS Default: [] A list of one or more remote hosts to run a test on. Defaults to []. --username=USERNAME Type: Optional[] Default: None Username for authentication of remote connections. Defaults to None. --password=PASSWORD Type: Optional[] Default: None Password for authentication of remote connections. Defaults to None. --ssh_key_path=SSH_KEY_PATH Type: Optional[] Default: None Path to a SSH Key for authentication of remote connections. Defaults to None. --private_key_string=PRIVATE_KEY_STRING Type: Optional[] Default: None A private SSH Key string used for authentication of remote connections. Defaults to None. --verify_ssl=VERIFY_SSL Default: False Whether or not to verify ssl when connecting over RDP (windows). Defaults to False. --ssh_port=SSH_PORT Default: 22 SSH port for authentication of remote connections. Defaults to 22. --ssh_timeout=SSH_TIMEOUT Default: 5 SSH timeout for authentication of remote connections. Defaults to 5. Additional flags are accepted. If provided, keys matching inputs for a test will be replaced. Default is None. Running atomic-operator using a config_file In addition to the ability to pass in parameters with atomic-operator you can also pass in a path to a config_file that contains all the atomic tests and their potential inputs. You can see an example of this config_file here: atomic_tests: - guid: f7e6ec05-c19e-4a80-a7e7-241027992fdb input_arguments: output_file: value: custom_output.txt input_file: value: custom_input.txt - guid: 3ff64f0b-3af2-3866-339d-38d9791407c3 input_arguments: second_arg: value: SWAPPPED argument - guid: 32f90516-4bc9-43bd-b18d-2cbe0b7ca9b2 Usage example (scripts) To use atomic-operator you must instantiate an AtomicOperator object. from atomic_operator import AtomicOperator operator = AtomicOperator() # This will download a local copy of the atomic-red-team repository print(operator.get_atomics('/tmp/some_directory')) # this will run tests on your local system operator.run( technique: str='All', atomics_path=os.getcwd(), check_dependencies=False, get_prereqs=False, cleanup=False, command_timeout=20, debug=False, prompt_for_input_args=False, **kwargs ) Getting Help Please create an issue if you have questions or run into any issues. Built With carcass - Python packaging template Contributing Please read CONTRIBUTING.md for details on our code of conduct, and the process for submitting pull requests to us. Versioning We use SemVer for versioning. Authors Josh Rickard - Initial work - MSAdministrator See also the list of contributors who participated in this project. License This project is licensed under the MIT License - see the LICENSE file for details Shoutout Thanks to keithmccammon for helping identify issues with macOS M1 based proccesssor and providing a fix","title":"Home"},{"location":"#atomic-operator","text":"This python package is used to execute Atomic Red Team tests (Atomics) across multiple operating system environments. ( What's new? )","title":"atomic-operator"},{"location":"#why","text":"atomic-operator enables security professionals to test their detection and defensive capabilities against prescribed techniques defined within atomic-red-team . By utilizing a testing framework such as atomic-operator , you can identify both your defensive capabilities as well as gaps in defensive coverage. Additionally, atomic-operator can be used in many other situations like: Generating alerts to test products Testing EDR and other security tools Identifying way to perform defensive evasion from an adversary perspective Plus more.","title":"Why?"},{"location":"#features","text":"Support local and remote execution of Atomic Red Teams tests on Windows, macOS, and Linux systems Supports running atomic-tests against iaas:aws Can prompt for input arguments but not required Assist with downloading the atomic-red-team repository Can be automated further based on a configuration file A command-line and importable Python package Select specific tests when one or more techniques are specified Plus more","title":"Features"},{"location":"#getting-started","text":"atomic-operator is a Python-only package hosted on PyPi and works with Python 3.6 and greater. If you are wanting a PowerShell version, please checkout Invoke-AtomicRedTeam . pip install atomic-operator The next steps will guide you through setting up and running atomic-operator . Get Atomics Install / clone Atomic Red Team repository atomic-operator Understand the options availble in atomic-operator Running Test on Command Line or Running Tests within a Script Running Tests via Configuration File","title":"Getting Started"},{"location":"#installation","text":"You can install atomic-operator on OS X, Linux, or Windows. You can also install it directly from the source. To install, see the commands under the relevant operating system heading, below.","title":"Installation"},{"location":"#prerequisites","text":"The following libraries are required and installed by atomic-operator: pyyaml==5.4.1 fire==0.4.0 requests==2.26.0 attrs==21.2.0 pick==1.2.0","title":"Prerequisites"},{"location":"#macos-linux-and-windows","text":"pip install atomic-operator","title":"macOS, Linux and Windows:"},{"location":"#macos-using-m1-processor","text":"git clone https://github.com/swimlane/atomic-operator.git cd atomic-operator # Satisfy ModuleNotFoundError: No module named 'setuptools_rust' brew install rust pip3 install --upgrade pip pip3 install setuptools_rust # Back to our regularly scheduled programming . . . python setup.py install","title":"macOS using M1 processor"},{"location":"#installing-from-source","text":"git clone https://github.com/swimlane/atomic-operator.git cd atomic-operator python setup.py install","title":"Installing from source"},{"location":"#usage-example-command-line","text":"You can run atomic-operator from the command line or within your own Python scripts. To use atomic-operator at the command line simply enter the following in your terminal: atomic-operator --help atomic-operator run -- --help Please note that to see details about the run command run atomic-operator run -- --help and NOT atomic-operator run --help","title":"Usage example (command line)"},{"location":"#retrieving-atomic-tests","text":"In order to use atomic-operator you must have one or more atomic-red-team tests (Atomics) on your local system. atomic-operator provides you with the ability to download the Atomic Red Team repository. You can do so by running the following at the command line: atomic-operator get_atomics # You can specify the destination directory by using the --destination flag atomic-operator get_atomics --destination \"/tmp/some_directory\"","title":"Retrieving Atomic Tests"},{"location":"#running-tests-locally","text":"In order to run a test you must provide some additional properties (and options if desired). The main method to run tests is named run . # This will run ALL tests compatiable with your local operating system atomic-operator run --atomics-path \"/tmp/some_directory/redcanaryco-atomic-red-team-3700624\" You can select individual tests when you provide one or more specific techniques. For example running the following on the command line: atomic-operator run --techniques T1564.001 --select_tests Will prompt the user with a selection list of tests associated with that technique. A user can select one or more tests by using the space bar to highlight the desired test: Select Test(s) for Technique T1564.001 (Hide Artifacts: Hidden Files and Directories) * Create a hidden file in a hidden directory (61a782e5-9a19-40b5-8ba4-69a4b9f3d7be) Mac Hidden file (cddb9098-3b47-4e01-9d3b-6f5f323288a9) Create Windows System File with Attrib (f70974c8-c094-4574-b542-2c545af95a32) Create Windows Hidden File with Attrib (dadb792e-4358-4d8d-9207-b771faa0daa5) Hidden files (3b7015f2-3144-4205-b799-b05580621379) Hide a Directory (b115ecaf-3b24-4ed2-aefe-2fcb9db913d3) Show all hidden files (9a1ec7da-b892-449f-ad68-67066d04380c)","title":"Running Tests Locally"},{"location":"#running-tests-remotely","text":"In order to run a test remotely you must provide some additional properties (and options if desired). The main method to run tests is named run . # This will run ALL tests compatiable with your local operating system atomic-operator run --atomics-path \"/tmp/some_directory/redcanaryco-atomic-red-team-3700624\" --hosts \"10.32.1.0\" --username \"my_username\" --password \"my_password\" When running commands remotely against Windows hosts you may need to configure PSRemoting. See details here: Windows Remoting","title":"Running Tests Remotely"},{"location":"#additional-parameters","text":"You can see additional parameters by running the following command: atomic-operator run -- --help Parameter Name Type Default Description techniques list all One or more defined techniques by attack_technique ID. test_guids list None One or more Atomic test GUIDs. select_tests bool False Select one or more atomic tests to run when a techniques are specified. atomics_path str os.getcwd() The path of Atomic tests. check_prereqs bool False Whether or not to check for prereq dependencies (prereq_comand). get_prereqs bool False Whether or not you want to retrieve prerequisites. cleanup bool False Whether or not you want to run cleanup command(s). copy_source_files bool True Whether or not you want to copy any related source (src, bin, etc.) files to a remote host. command_timeout int 20 Time duration for each command before timeout. debug bool False Whether or not you want to output details about tests being ran. prompt_for_input_args bool False Whether you want to prompt for input arguments for each test. return_atomics bool False Whether or not you want to return atomics instead of running them. config_file str None A path to a conifg_file which is used to automate atomic-operator in environments. config_file_only bool False Whether or not you want to run tests based on the provided config_file only. hosts list None A list of one or more remote hosts to run a test on. username str None Username for authentication of remote connections. password str None Password for authentication of remote connections. ssh_key_path str None Path to a SSH Key for authentication of remote connections. private_key_string str None A private SSH Key string used for authentication of remote connections. verify_ssl bool False Whether or not to verify ssl when connecting over RDP (windows). ssh_port int 22 SSH port for authentication of remote connections. ssh_timeout int 5 SSH timeout for authentication of remote connections. **kwargs dict None If additional flags are passed into the run command then we will attempt to match them with defined inputs within Atomic tests and replace their value with the provided value. You should see a similar output to the following: NAME atomic-operator run - The main method in which we run Atomic Red Team tests. SYNOPSIS atomic-operator run <flags> DESCRIPTION The main method in which we run Atomic Red Team tests. FLAGS --techniques=TECHNIQUES Type: list Default: ['all'] One or more defined techniques by attack_technique ID. Defaults to 'all'. --test_guids=TEST_GUIDS Type: list Default: [] One or more Atomic test GUIDs. Defaults to None. --select_tests=SELECT_TESTS Type: bool Default: False Select one or more tests from provided techniques. Defaults to False. --atomics_path=ATOMICS_PATH Default: '/U... The path of Atomic tests. Defaults to os.getcwd(). --check_prereqs=CHECK_PREREQS Default: False Whether or not to check for prereq dependencies (prereq_comand). Defaults to False. --get_prereqs=GET_PREREQS Default: False Whether or not you want to retrieve prerequisites. Defaults to False. --cleanup=CLEANUP Default: False Whether or not you want to run cleanup command(s). Defaults to False. --copy_source_files=COPY_SOURCE_FILES Default: True Whether or not you want to copy any related source (src, bin, etc.) files to a remote host. Defaults to True. --command_timeout=COMMAND_TIMEOUT Default: 20 Timeout duration for each command. Defaults to 20. --debug=DEBUG Default: False Whether or not you want to output details about tests being ran. Defaults to False. --prompt_for_input_args=PROMPT_FOR_INPUT_ARGS Default: False Whether you want to prompt for input arguments for each test. Defaults to False. --return_atomics=RETURN_ATOMICS Default: False Whether or not you want to return atomics instead of running them. Defaults to False. --config_file=CONFIG_FILE Type: Optional[] Default: None A path to a conifg_file which is used to automate atomic-operator in environments. Default to None. --config_file_only=CONFIG_FILE_ONLY Default: False Whether or not you want to run tests based on the provided config_file only. Defaults to False. --hosts=HOSTS Default: [] A list of one or more remote hosts to run a test on. Defaults to []. --username=USERNAME Type: Optional[] Default: None Username for authentication of remote connections. Defaults to None. --password=PASSWORD Type: Optional[] Default: None Password for authentication of remote connections. Defaults to None. --ssh_key_path=SSH_KEY_PATH Type: Optional[] Default: None Path to a SSH Key for authentication of remote connections. Defaults to None. --private_key_string=PRIVATE_KEY_STRING Type: Optional[] Default: None A private SSH Key string used for authentication of remote connections. Defaults to None. --verify_ssl=VERIFY_SSL Default: False Whether or not to verify ssl when connecting over RDP (windows). Defaults to False. --ssh_port=SSH_PORT Default: 22 SSH port for authentication of remote connections. Defaults to 22. --ssh_timeout=SSH_TIMEOUT Default: 5 SSH timeout for authentication of remote connections. Defaults to 5. Additional flags are accepted. If provided, keys matching inputs for a test will be replaced. Default is None.","title":"Additional parameters"},{"location":"#running-atomic-operator-using-a-config_file","text":"In addition to the ability to pass in parameters with atomic-operator you can also pass in a path to a config_file that contains all the atomic tests and their potential inputs. You can see an example of this config_file here: atomic_tests: - guid: f7e6ec05-c19e-4a80-a7e7-241027992fdb input_arguments: output_file: value: custom_output.txt input_file: value: custom_input.txt - guid: 3ff64f0b-3af2-3866-339d-38d9791407c3 input_arguments: second_arg: value: SWAPPPED argument - guid: 32f90516-4bc9-43bd-b18d-2cbe0b7ca9b2","title":"Running atomic-operator using a config_file"},{"location":"#usage-example-scripts","text":"To use atomic-operator you must instantiate an AtomicOperator object. from atomic_operator import AtomicOperator operator = AtomicOperator() # This will download a local copy of the atomic-red-team repository print(operator.get_atomics('/tmp/some_directory')) # this will run tests on your local system operator.run( technique: str='All', atomics_path=os.getcwd(), check_dependencies=False, get_prereqs=False, cleanup=False, command_timeout=20, debug=False, prompt_for_input_args=False, **kwargs )","title":"Usage example (scripts)"},{"location":"#getting-help","text":"Please create an issue if you have questions or run into any issues.","title":"Getting Help"},{"location":"#built-with","text":"carcass - Python packaging template","title":"Built With"},{"location":"#contributing","text":"Please read CONTRIBUTING.md for details on our code of conduct, and the process for submitting pull requests to us.","title":"Contributing"},{"location":"#versioning","text":"We use SemVer for versioning.","title":"Versioning"},{"location":"#authors","text":"Josh Rickard - Initial work - MSAdministrator See also the list of contributors who participated in this project.","title":"Authors"},{"location":"#license","text":"This project is licensed under the MIT License - see the LICENSE file for details","title":"License"},{"location":"#shoutout","text":"Thanks to keithmccammon for helping identify issues with macOS M1 based proccesssor and providing a fix","title":"Shoutout"},{"location":"CHANGELOG/","text":"CHANGELOG 0.7.0 - 2022-01-04 * Updated argument handling in get_atomics Retrieving Atomic Tests with specified destination in /opt throws unexpected keyword argument error #28 * Updated error catching and logging within state machine class when copying source files to remote system Logging and troubleshooting question #32 * Updated ConfigParser from instance variables to local method bound variables Using a second AtomicOperator instance executes the tests of the first instance too #33 * Added the ability to select specific tests for one or more provided techniques * Updated documentation * Added new Copier class to handle file transfer for remote connections * Removed gathering of supporting_files and passing around with object * Added new config_file_only parameter to only run the defined configuration within a configuration file * Updated documentation around installation on macOS systems with M1 processors 0.6.0 - 2021-12-17 * Updated documentation * Added better handling of help 0.5.1 - 2021-11-18 * Updating handling of passing --help to the run command * Updated docs to reflect change 0.5.0 - 2021-11-19 * Updated and expanded tests * Added CI to build docs and deploy to pypi * Updated localrunner to support windows based on changes made previously 0.4.0 - 2021-11-15 * Added support for transferring files during remote execution * Refactored config handling * Updated docs and githubpages 0.2.0 - 2021-10-05 * Added support for remote execution of atomic-tests * Added support for executing iaas:aws tests * Added configuration support * Plus many other features 0.0.1 - 2021-07-26 Initial release","title":"Changelog"},{"location":"CHANGELOG/#changelog","text":"","title":"CHANGELOG"},{"location":"CHANGELOG/#070-2022-01-04","text":"* Updated argument handling in get_atomics Retrieving Atomic Tests with specified destination in /opt throws unexpected keyword argument error #28 * Updated error catching and logging within state machine class when copying source files to remote system Logging and troubleshooting question #32 * Updated ConfigParser from instance variables to local method bound variables Using a second AtomicOperator instance executes the tests of the first instance too #33 * Added the ability to select specific tests for one or more provided techniques * Updated documentation * Added new Copier class to handle file transfer for remote connections * Removed gathering of supporting_files and passing around with object * Added new config_file_only parameter to only run the defined configuration within a configuration file * Updated documentation around installation on macOS systems with M1 processors","title":"0.7.0 - 2022-01-04"},{"location":"CHANGELOG/#060-2021-12-17","text":"* Updated documentation * Added better handling of help","title":"0.6.0 - 2021-12-17"},{"location":"CHANGELOG/#051-2021-11-18","text":"* Updating handling of passing --help to the run command * Updated docs to reflect change","title":"0.5.1 - 2021-11-18"},{"location":"CHANGELOG/#050-2021-11-19","text":"* Updated and expanded tests * Added CI to build docs and deploy to pypi * Updated localrunner to support windows based on changes made previously","title":"0.5.0 - 2021-11-19"},{"location":"CHANGELOG/#040-2021-11-15","text":"* Added support for transferring files during remote execution * Refactored config handling * Updated docs and githubpages","title":"0.4.0 - 2021-11-15"},{"location":"CHANGELOG/#020-2021-10-05","text":"* Added support for remote execution of atomic-tests * Added support for executing iaas:aws tests * Added configuration support * Plus many other features","title":"0.2.0 - 2021-10-05"},{"location":"CHANGELOG/#001-2021-07-26","text":"Initial release","title":"0.0.1 - 2021-07-26"},{"location":"CONTRIBUTING/","text":"Contributing When contributing to this repository, please first discuss the change you wish to make via issue, email, or any other method with the owners of this repository before making a change. Please note we have a code of conduct, please follow it in all your interactions with the project. Pull Request Process Ensure any install or build dependencies are removed before the end of the layer when doing a build. Update the README.md with details of changes to the interface, this includes new environment variables, exposed ports, useful file locations and container parameters. Increase the version numbers in any examples files and the README.md to the new version that this Pull Request would represent. The versioning scheme we use is SemVer . You may merge the Pull Request in once you have the sign-off of two other developers, or if you do not have permission to do that, you may request the second reviewer to merge it for you. Code of Conduct Our Pledge In the interest of fostering an open and welcoming environment, we as contributors and maintainers pledge to making participation in our project and our community a harassment-free experience for everyone, regardless of age, body size, disability, ethnicity, gender identity and expression, level of experience, nationality, personal appearance, race, religion, or sexual identity and orientation. Our Standards Examples of behavior that contributes to creating a positive environment include: Using welcoming and inclusive language Being respectful of differing viewpoints and experiences Gracefully accepting constructive criticism Focusing on what is best for the community Showing empathy towards other community members Examples of unacceptable behavior by participants include: The use of sexualized language or imagery and unwelcome sexual attention or advances Trolling, insulting/derogatory comments, and personal or political attacks Public or private harassment Publishing others' private information, such as a physical or electronic address, without explicit permission Other conduct which could reasonably be considered inappropriate in a professional setting Our Responsibilities Project maintainers are responsible for clarifying the standards of acceptable behavior and are expected to take appropriate and fair corrective action in response to any instances of unacceptable behavior. Project maintainers have the right and responsibility to remove, edit, or reject comments, commits, code, wiki edits, issues, and other contributions that are not aligned to this Code of Conduct, or to ban temporarily or permanently any contributor for other behaviors that they deem inappropriate, threatening, offensive, or harmful. Scope This Code of Conduct applies both within project spaces and in public spaces when an individual is representing the project or its community. Examples of representing a project or community include using an official project e-mail address, posting via an official social media account, or acting as an appointed representative at an online or offline event. Representation of a project may be further defined and clarified by project maintainers. Enforcement Instances of abusive, harassing, or otherwise unacceptable behavior may be reported by contacting the project team at [INSERT EMAIL ADDRESS]. All complaints will be reviewed and investigated and will result in a response that is deemed necessary and appropriate to the circumstances. The project team is obligated to maintain confidentiality with regard to the reporter of an incident. Further details of specific enforcement policies may be posted separately. Project maintainers who do not follow or enforce the Code of Conduct in good faith may face temporary or permanent repercussions as determined by other members of the project's leadership. Attribution This Code of Conduct is adapted from the Contributor Covenant , version 1.4, available at http://contributor-covenant.org/version/1/4","title":"Contributing"},{"location":"CONTRIBUTING/#contributing","text":"When contributing to this repository, please first discuss the change you wish to make via issue, email, or any other method with the owners of this repository before making a change. Please note we have a code of conduct, please follow it in all your interactions with the project.","title":"Contributing"},{"location":"CONTRIBUTING/#pull-request-process","text":"Ensure any install or build dependencies are removed before the end of the layer when doing a build. Update the README.md with details of changes to the interface, this includes new environment variables, exposed ports, useful file locations and container parameters. Increase the version numbers in any examples files and the README.md to the new version that this Pull Request would represent. The versioning scheme we use is SemVer . You may merge the Pull Request in once you have the sign-off of two other developers, or if you do not have permission to do that, you may request the second reviewer to merge it for you.","title":"Pull Request Process"},{"location":"CONTRIBUTING/#code-of-conduct","text":"","title":"Code of Conduct"},{"location":"CONTRIBUTING/#our-pledge","text":"In the interest of fostering an open and welcoming environment, we as contributors and maintainers pledge to making participation in our project and our community a harassment-free experience for everyone, regardless of age, body size, disability, ethnicity, gender identity and expression, level of experience, nationality, personal appearance, race, religion, or sexual identity and orientation.","title":"Our Pledge"},{"location":"CONTRIBUTING/#our-standards","text":"Examples of behavior that contributes to creating a positive environment include: Using welcoming and inclusive language Being respectful of differing viewpoints and experiences Gracefully accepting constructive criticism Focusing on what is best for the community Showing empathy towards other community members Examples of unacceptable behavior by participants include: The use of sexualized language or imagery and unwelcome sexual attention or advances Trolling, insulting/derogatory comments, and personal or political attacks Public or private harassment Publishing others' private information, such as a physical or electronic address, without explicit permission Other conduct which could reasonably be considered inappropriate in a professional setting","title":"Our Standards"},{"location":"CONTRIBUTING/#our-responsibilities","text":"Project maintainers are responsible for clarifying the standards of acceptable behavior and are expected to take appropriate and fair corrective action in response to any instances of unacceptable behavior. Project maintainers have the right and responsibility to remove, edit, or reject comments, commits, code, wiki edits, issues, and other contributions that are not aligned to this Code of Conduct, or to ban temporarily or permanently any contributor for other behaviors that they deem inappropriate, threatening, offensive, or harmful.","title":"Our Responsibilities"},{"location":"CONTRIBUTING/#scope","text":"This Code of Conduct applies both within project spaces and in public spaces when an individual is representing the project or its community. Examples of representing a project or community include using an official project e-mail address, posting via an official social media account, or acting as an appointed representative at an online or offline event. Representation of a project may be further defined and clarified by project maintainers.","title":"Scope"},{"location":"CONTRIBUTING/#enforcement","text":"Instances of abusive, harassing, or otherwise unacceptable behavior may be reported by contacting the project team at [INSERT EMAIL ADDRESS]. All complaints will be reviewed and investigated and will result in a response that is deemed necessary and appropriate to the circumstances. The project team is obligated to maintain confidentiality with regard to the reporter of an incident. Further details of specific enforcement policies may be posted separately. Project maintainers who do not follow or enforce the Code of Conduct in good faith may face temporary or permanent repercussions as determined by other members of the project's leadership.","title":"Enforcement"},{"location":"CONTRIBUTING/#attribution","text":"This Code of Conduct is adapted from the Contributor Covenant , version 1.4, available at http://contributor-covenant.org/version/1/4","title":"Attribution"},{"location":"LICENSE/","text":"MIT License Copyright (c) 2021 Swimlane Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions: The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software. THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.","title":"License"},{"location":"atomic-operator-config/","text":"Configuration One feature of atomic-operator is the ability to automate running of Atomics even further via a configuration file. The configuration file supports many different layouts for configuration but the major features are: Define one or more Atomic tests by GUID You can provide values for any defined input arguments for an Atomic test You can assign an Atomic test to one or more inventory objects Define none, one, or more inventory objects An inventory is a collection of authentication properties as well as hosts associated with said authentication credentials With this structure you can create an inventory group of 1 or 100 hosts using a set of credentials and tell atomic-operator to run 1 or more tests with defined inputs against those hosts - infinitely flexible. Below is an example of all of these features implemented in a configuration file. inventory: windows1: executor: powershell # or cmd authentication: username: username password: some_passowrd! verify_ssl: false hosts: - 192.168.1.1 - 10.32.1.1 # etc linux1: executor: ssh authentication: username: username password: some_passowrd! #ssk_key_path: port: 22 timeout: 5 hosts: - 192.168.1.1 - 10.32.100.1 # etc. atomic_tests: - guid: f7e6ec05-c19e-4a80-a7e7-241027992fdb input_arguments: output_file: value: custom_output.txt input_file: value: custom_input.txt inventories: - windows1 - guid: 3ff64f0b-3af2-3866-339d-38d9791407c3 input_arguments: second_arg: value: SWAPPPED argument inventories: - windows1 - linux1 - guid: c141bbdb-7fca-4254-9fd6-f47e79447e17 inventories: - linux1 At the basic level of the configuration file you can simply just have one that defines a set of Atomic tests you want to run like so: atomic_tests: - guid: f7e6ec05-c19e-4a80-a7e7-241027992fdb - guid: 3ff64f0b-3af2-3866-339d-38d9791407c3 - guid: c141bbdb-7fca-4254-9fd6-f47e79447e17 You can also specify input variable values for one or more of them: atomic_tests: - guid: f7e6ec05-c19e-4a80-a7e7-241027992fdb input_arguments: output_file: value: custom_output.txt input_file: value: custom_input.txt - guid: 3ff64f0b-3af2-3866-339d-38d9791407c3 - guid: c141bbdb-7fca-4254-9fd6-f47e79447e17 But if you want to run them remotely then you must add in inventory objects with the correct credentials and one or more hosts: inventory: windows1: executor: powershell # or cmd authentication: username: username password: some_passowrd! verify_ssl: false hosts: - 192.168.1.1 - 10.32.1.1 atomic_tests: - guid: f7e6ec05-c19e-4a80-a7e7-241027992fdb input_arguments: output_file: value: custom_output.txt input_file: value: custom_input.txt inventories: - windows1 - guid: 3ff64f0b-3af2-3866-339d-38d9791407c3 - guid: c141bbdb-7fca-4254-9fd6-f47e79447e17","title":"Running Tests via Configuration File"},{"location":"atomic-operator-config/#configuration","text":"One feature of atomic-operator is the ability to automate running of Atomics even further via a configuration file. The configuration file supports many different layouts for configuration but the major features are: Define one or more Atomic tests by GUID You can provide values for any defined input arguments for an Atomic test You can assign an Atomic test to one or more inventory objects Define none, one, or more inventory objects An inventory is a collection of authentication properties as well as hosts associated with said authentication credentials With this structure you can create an inventory group of 1 or 100 hosts using a set of credentials and tell atomic-operator to run 1 or more tests with defined inputs against those hosts - infinitely flexible. Below is an example of all of these features implemented in a configuration file. inventory: windows1: executor: powershell # or cmd authentication: username: username password: some_passowrd! verify_ssl: false hosts: - 192.168.1.1 - 10.32.1.1 # etc linux1: executor: ssh authentication: username: username password: some_passowrd! #ssk_key_path: port: 22 timeout: 5 hosts: - 192.168.1.1 - 10.32.100.1 # etc. atomic_tests: - guid: f7e6ec05-c19e-4a80-a7e7-241027992fdb input_arguments: output_file: value: custom_output.txt input_file: value: custom_input.txt inventories: - windows1 - guid: 3ff64f0b-3af2-3866-339d-38d9791407c3 input_arguments: second_arg: value: SWAPPPED argument inventories: - windows1 - linux1 - guid: c141bbdb-7fca-4254-9fd6-f47e79447e17 inventories: - linux1 At the basic level of the configuration file you can simply just have one that defines a set of Atomic tests you want to run like so: atomic_tests: - guid: f7e6ec05-c19e-4a80-a7e7-241027992fdb - guid: 3ff64f0b-3af2-3866-339d-38d9791407c3 - guid: c141bbdb-7fca-4254-9fd6-f47e79447e17 You can also specify input variable values for one or more of them: atomic_tests: - guid: f7e6ec05-c19e-4a80-a7e7-241027992fdb input_arguments: output_file: value: custom_output.txt input_file: value: custom_input.txt - guid: 3ff64f0b-3af2-3866-339d-38d9791407c3 - guid: c141bbdb-7fca-4254-9fd6-f47e79447e17 But if you want to run them remotely then you must add in inventory objects with the correct credentials and one or more hosts: inventory: windows1: executor: powershell # or cmd authentication: username: username password: some_passowrd! verify_ssl: false hosts: - 192.168.1.1 - 10.32.1.1 atomic_tests: - guid: f7e6ec05-c19e-4a80-a7e7-241027992fdb input_arguments: output_file: value: custom_output.txt input_file: value: custom_input.txt inventories: - windows1 - guid: 3ff64f0b-3af2-3866-339d-38d9791407c3 - guid: c141bbdb-7fca-4254-9fd6-f47e79447e17","title":"Configuration"},{"location":"atomic-operator-ref/","text":"AtomicOperator ( Base ) Main class used to run Atomic Red Team tests. atomic-operator is used to run Atomic Red Team tests both locally and remotely. These tests (atomics) are predefined tests to mock or emulate a specific technique. config_file definition: atomic-operator's run method can be supplied with a path to a configuration file (config_file) which defines specific tests and/or values for input parameters to facilitate automation of said tests. An example of this config_file can be seen below: inventory: linux1: executor: ssh authentication: username: root password: UR4Swimlane! #ssk_key_path: port: 22 timeout: 5 hosts: # - 192.168.1.1 - 10.32.100.199 # etc. atomic_tests: - guid: f7e6ec05-c19e-4a80-a7e7-241027992fdb input_arguments: output_file: value: custom_output.txt input_file: value: custom_input.txt - guid: 3ff64f0b-3af2-3866-339d-38d9791407c3 input_arguments: second_arg: value: SWAPPPED argument - guid: 32f90516-4bc9-43bd-b18d-2cbe0b7ca9b2 inventories: - linux1 Exceptions: Type Description ValueError If a provided technique is unknown we raise an error. get_atomics ( self , desintation = '/home/runner/work/atomic-operator/atomic-operator' , ** kwargs ) Downloads the RedCanary atomic-red-team repository to your local system. Parameters: Name Type Description Default desintation str A folder path to download the repositorty data to. Defaults to os.getcwd(). '/home/runner/work/atomic-operator/atomic-operator' kwargs dict This kwargs will be passed along to Python requests library during download. Defaults to None. {} Returns: Type Description str The path the data can be found at. Source code in atomic_operator/atomic_operator.py def get_atomics ( self , desintation = os . getcwd (), ** kwargs ): \"\"\"Downloads the RedCanary atomic-red-team repository to your local system. Args: desintation (str, optional): A folder path to download the repositorty data to. Defaults to os.getcwd(). kwargs (dict, optional): This kwargs will be passed along to Python requests library during download. Defaults to None. Returns: str: The path the data can be found at. \"\"\" if not os . path . exists ( desintation ): os . makedirs ( desintation ) desintation = kwargs . pop ( 'destination' ) if kwargs . get ( 'destination' ) else desintation folder_name = self . download_atomic_red_team_repo ( save_path = desintation , ** kwargs ) return os . path . join ( desintation , folder_name ) run ( self , techniques = [ 'all' ], test_guids = [], select_tests = False , atomics_path = '/home/runner/work/atomic-operator/atomic-operator' , check_prereqs = False , get_prereqs = False , cleanup = False , copy_source_files = True , command_timeout = 20 , debug = False , prompt_for_input_args = False , return_atomics = False , config_file = None , config_file_only = False , hosts = [], username = None , password = None , ssh_key_path = None , private_key_string = None , verify_ssl = False , ssh_port = 22 , ssh_timeout = 5 , * args , ** kwargs ) The main method in which we run Atomic Red Team tests. Parameters: Name Type Description Default techniques list One or more defined techniques by attack_technique ID. Defaults to 'all'. ['all'] test_guids list One or more Atomic test GUIDs. Defaults to None. [] select_tests bool Select one or more tests from provided techniques. Defaults to False. False atomics_path str The path of Atomic tests. Defaults to os.getcwd(). '/home/runner/work/atomic-operator/atomic-operator' check_prereqs bool Whether or not to check for prereq dependencies (prereq_comand). Defaults to False. False get_prereqs bool Whether or not you want to retrieve prerequisites. Defaults to False. False cleanup bool Whether or not you want to run cleanup command(s). Defaults to False. False copy_source_files bool Whether or not you want to copy any related source (src, bin, etc.) files to a remote host. Defaults to True. True command_timeout int Timeout duration for each command. Defaults to 20. 20 debug bool Whether or not you want to output details about tests being ran. Defaults to False. False prompt_for_input_args bool Whether you want to prompt for input arguments for each test. Defaults to False. False return_atomics bool Whether or not you want to return atomics instead of running them. Defaults to False. False config_file str A path to a conifg_file which is used to automate atomic-operator in environments. Default to None. None config_file_only bool Whether or not you want to run tests based on the provided config_file only. Defaults to False. False hosts list A list of one or more remote hosts to run a test on. Defaults to []. [] username str Username for authentication of remote connections. Defaults to None. None password str Password for authentication of remote connections. Defaults to None. None ssh_key_path str Path to a SSH Key for authentication of remote connections. Defaults to None. None private_key_string str A private SSH Key string used for authentication of remote connections. Defaults to None. None verify_ssl bool Whether or not to verify ssl when connecting over RDP (windows). Defaults to False. False ssh_port int SSH port for authentication of remote connections. Defaults to 22. 22 ssh_timeout int SSH timeout for authentication of remote connections. Defaults to 5. 5 kwargs dict If provided, keys matching inputs for a test will be replaced. Default is None. {} Exceptions: Type Description ValueError If a provided technique is unknown we raise an error. Source code in atomic_operator/atomic_operator.py def run ( self , techniques : list = [ 'all' ], test_guids : list = [], select_tests = False , atomics_path = os . getcwd (), check_prereqs = False , get_prereqs = False , cleanup = False , copy_source_files = True , command_timeout = 20 , debug = False , prompt_for_input_args = False , return_atomics = False , config_file = None , config_file_only = False , hosts = [], username = None , password = None , ssh_key_path = None , private_key_string = None , verify_ssl = False , ssh_port = 22 , ssh_timeout = 5 , * args , ** kwargs ) -> None : \"\"\"The main method in which we run Atomic Red Team tests. Args: techniques (list, optional): One or more defined techniques by attack_technique ID. Defaults to 'all'. test_guids (list, optional): One or more Atomic test GUIDs. Defaults to None. select_tests (bool, optional): Select one or more tests from provided techniques. Defaults to False. atomics_path (str, optional): The path of Atomic tests. Defaults to os.getcwd(). check_prereqs (bool, optional): Whether or not to check for prereq dependencies (prereq_comand). Defaults to False. get_prereqs (bool, optional): Whether or not you want to retrieve prerequisites. Defaults to False. cleanup (bool, optional): Whether or not you want to run cleanup command(s). Defaults to False. copy_source_files (bool, optional): Whether or not you want to copy any related source (src, bin, etc.) files to a remote host. Defaults to True. command_timeout (int, optional): Timeout duration for each command. Defaults to 20. debug (bool, optional): Whether or not you want to output details about tests being ran. Defaults to False. prompt_for_input_args (bool, optional): Whether you want to prompt for input arguments for each test. Defaults to False. return_atomics (bool, optional): Whether or not you want to return atomics instead of running them. Defaults to False. config_file (str, optional): A path to a conifg_file which is used to automate atomic-operator in environments. Default to None. config_file_only (bool, optional): Whether or not you want to run tests based on the provided config_file only. Defaults to False. hosts (list, optional): A list of one or more remote hosts to run a test on. Defaults to []. username (str, optional): Username for authentication of remote connections. Defaults to None. password (str, optional): Password for authentication of remote connections. Defaults to None. ssh_key_path (str, optional): Path to a SSH Key for authentication of remote connections. Defaults to None. private_key_string (str, optional): A private SSH Key string used for authentication of remote connections. Defaults to None. verify_ssl (bool, optional): Whether or not to verify ssl when connecting over RDP (windows). Defaults to False. ssh_port (int, optional): SSH port for authentication of remote connections. Defaults to 22. ssh_timeout (int, optional): SSH timeout for authentication of remote connections. Defaults to 5. kwargs (dict, optional): If provided, keys matching inputs for a test will be replaced. Default is None. Raises: ValueError: If a provided technique is unknown we raise an error. \"\"\" response = self . __check_arguments ( kwargs , self . run ) if response : return response if kwargs . get ( 'help' ): return self . help ( method = 'run' ) if debug : import logging logging . getLogger () . setLevel ( logging . DEBUG ) count = 0 if check_prereqs : count += 1 if get_prereqs : count += 1 if cleanup : count += 1 if count > 1 : return IncorrectParameters ( f \"You have passed in incompatible arguments. Please only provide one of 'check_prereqs','get_prereqs','cleanup'.\" ) atomics_path = self . __find_path ( atomics_path ) if not atomics_path : return AtomicsFolderNotFound ( 'Unable to find a folder containing Atomics. Please provide a path or run get_atomics.' ) Base . CONFIG = Config ( atomics_path = atomics_path , check_prereqs = check_prereqs , get_prereqs = get_prereqs , cleanup = cleanup , command_timeout = command_timeout , debug = debug , prompt_for_input_args = prompt_for_input_args , kwargs = kwargs , copy_source_files = copy_source_files ) # taking inputs from both config_file and passed in values via command # line to build a run_list of objects self . __config_parser = ConfigParser ( config_file = config_file , techniques = None if config_file_only else self . parse_input_lists ( techniques ), test_guids = None if config_file_only else self . parse_input_lists ( test_guids ), host_list = None if config_file_only else self . parse_input_lists ( hosts ), username = username , password = password , ssh_key_path = ssh_key_path , private_key_string = private_key_string , verify_ssl = verify_ssl , ssh_port = ssh_port , ssh_timeout = ssh_timeout , select_tests = select_tests ) self . __run_list = self . __config_parser . run_list __return_atomics = [] for item in self . __run_list : if return_atomics : __return_atomics . append ( item ) elif kwargs . get ( 'kwargs' ): self . __run_technique ( item , ** kwargs . get ( 'kwargs' )) else : self . __run_technique ( item ) if return_atomics and __return_atomics : return __return_atomics return self . __test_responses Base download_atomic_red_team_repo ( self , save_path , ** kwargs ) Downloads the Atomic Red Team repository from github Parameters: Name Type Description Default save_path str The path to save the downloaded and extracted ZIP contents required Returns: Type Description str A string of the location the data was saved to. Source code in atomic_operator/base.py def download_atomic_red_team_repo ( self , save_path , ** kwargs ) -> str : \"\"\"Downloads the Atomic Red Team repository from github Args: save_path (str): The path to save the downloaded and extracted ZIP contents Returns: str: A string of the location the data was saved to. \"\"\" response = requests . get ( Base . ATOMIC_RED_TEAM_REPO , stream = True , ** kwargs ) z = zipfile . ZipFile ( BytesIO ( response . content )) with zipfile . ZipFile ( BytesIO ( response . content )) as zf : for member in zf . infolist (): file_path = os . path . realpath ( os . path . join ( save_path , member . filename )) if file_path . startswith ( os . path . realpath ( save_path )): zf . extract ( member , save_path ) return z . namelist ()[ 0 ] get_abs_path ( self , value ) Formats and returns the absolute path for a path value Parameters: Name Type Description Default value str A path string in many different accepted formats required Returns: Type Description str The absolute path of the provided string Source code in atomic_operator/base.py def get_abs_path ( self , value ) -> str : \"\"\"Formats and returns the absolute path for a path value Args: value (str): A path string in many different accepted formats Returns: str: The absolute path of the provided string \"\"\" return os . path . abspath ( os . path . expanduser ( os . path . expandvars ( value ))) get_local_system_platform ( self ) Identifies the local systems operating system platform Returns: Type Description str The current/local systems operating system platform Source code in atomic_operator/base.py def get_local_system_platform ( self ) -> str : \"\"\"Identifies the local systems operating system platform Returns: str: The current/local systems operating system platform \"\"\" os_name = platform . system () . lower () if os_name == \"darwin\" : return \"macos\" return os_name prompt_user_for_input ( self , title , input_object ) Prompts user for input values based on the provided values. Source code in atomic_operator/base.py def prompt_user_for_input ( self , title , input_object ): \"\"\"Prompts user for input values based on the provided values. \"\"\" print ( f \"\"\" Inputs for { title } : Input Name: { input_object . name } Default: { input_object . default } Description: { input_object . description } \"\"\" ) print ( f \"Please provide a value for { input_object . name } (If blank, default is used):\" ,) value = sys . stdin . readline () if bool ( value ): return value return input_object . default ConfigParser ( Base ) config property readonly Returns raw converted config_file passed into class Returns: Type Description [dict] Returns the converted config_file as dictionary. run_list property readonly Returns a list of Atomic objects that will be ran. This list combines Atomics and potentially filters tests defined within that Atomic object based on passed in parameters and config_file. Additionally, a list of Host objects are added to their defined techniques or test_guids based on config and/or passed in parameters. [ Atomic( attack_technique='T1016', display_name='System Network Configuration Discovery', path='/Users/josh.rickard/_Swimlane2/atomic-operator/redcanaryco-atomic-red-team-22dd2fb/atomics/T1016', atomic_tests=[ AtomicTest( name='System Network Configuration Discovery', description='Identify network configuration information. Upon successful execution, ...', supported_platforms=['macos', 'linux'], auto_generated_guid='c141bbdb-7fca-4254-9fd6-f47e79447e17', executor=AtomicExecutor( name='sh', command='if [ -x \"$(command -v arp)\" ]; then arp -a; else echo \"arp is missing from ....', cleanup_command=None, elevation_required=False, steps=None ), input_arguments=None, dependency_executor_name=None, dependencies=[] ) ], hosts=[ Host( hostname='192.168.1.1', username='username', password='some_passowrd!', verify_ssl=False, ssh_key_path=None, private_key_string=None, port=22, timeout=5 ) ], supporting_files=[ 'redcanaryco-atomic-red-team-22dd2fb/atomics/T1016/src/top-128.txt', 'redcanaryco-atomic-red-team-22dd2fb/atomics/T1016/src/qakbot.bat' ] ) ] !!! returns [list]: A list of modified Atomic objects that will be used to run either remotely or locally. __init__ ( self , config_file = None , techniques = None , test_guids = None , host_list = None , username = None , password = None , ssh_key_path = None , private_key_string = None , verify_ssl = False , ssh_port = 22 , ssh_timeout = 5 , select_tests = False ) special Parses a provided config file as well as parameters to build a run list This list combines Atomics and potentially filters tests defined within that Atomic object based on passed in parameters and config_file. Additionally, a list of Host objects are added to their defined techniques or test_guids based on config and/or passed in parameters. Example: Example structure returned from provided values [ Atomic( attack_technique='T1016', display_name='System Network Configuration Discovery', path='/Users/josh.rickard/_Swimlane2/atomic-operator/redcanaryco-atomic-red-team-22dd2fb/atomics/T1016', atomic_tests=[ AtomicTest( name='System Network Configuration Discovery', description='Identify network configuration information. Upon successful execution, ...', supported_platforms=['macos', 'linux'], auto_generated_guid='c141bbdb-7fca-4254-9fd6-f47e79447e17', executor=AtomicExecutor( name='sh', command='if [ -x \"$(command -v arp)\" ]; then arp -a; else echo \"arp is missing from ....', cleanup_command=None, elevation_required=False, steps=None ), input_arguments=None, dependency_executor_name=None, dependencies=[] ) ], hosts=[ Host( hostname='192.168.1.1', username='username', password='some_passowrd!', verify_ssl=False, ssh_key_path=None, private_key_string=None, port=22, timeout=5 ) ], supporting_files=[ 'redcanaryco-atomic-red-team-22dd2fb/atomics/T1016/src/top-128.txt', 'redcanaryco-atomic-red-team-22dd2fb/atomics/T1016/src/qakbot.bat' ] ) ] Source code in atomic_operator/configparser.py def __init__ ( self , config_file = None , techniques = None , test_guids = None , host_list = None , username = None , password = None , ssh_key_path = None , private_key_string = None , verify_ssl = False , ssh_port = 22 , ssh_timeout = 5 , select_tests = False ): \"\"\"Parses a provided config file as well as parameters to build a run list This list combines Atomics and potentially filters tests defined within that Atomic object based on passed in parameters and config_file. Additionally, a list of Host objects are added to their defined techniques or test_guids based on config and/or passed in parameters. Example: Example structure returned from provided values [ Atomic( attack_technique='T1016', display_name='System Network Configuration Discovery', path='/Users/josh.rickard/_Swimlane2/atomic-operator/redcanaryco-atomic-red-team-22dd2fb/atomics/T1016', atomic_tests=[ AtomicTest( name='System Network Configuration Discovery', description='Identify network configuration information.\\n\\nUpon successful execution, ...', supported_platforms=['macos', 'linux'], auto_generated_guid='c141bbdb-7fca-4254-9fd6-f47e79447e17', executor=AtomicExecutor( name='sh', command='if [ -x \"$(command -v arp)\" ]; then arp -a; else echo \"arp is missing from ....', cleanup_command=None, elevation_required=False, steps=None ), input_arguments=None, dependency_executor_name=None, dependencies=[] ) ], hosts=[ Host( hostname='192.168.1.1', username='username', password='some_passowrd!', verify_ssl=False, ssh_key_path=None, private_key_string=None, port=22, timeout=5 ) ], supporting_files=[ 'redcanaryco-atomic-red-team-22dd2fb/atomics/T1016/src/top-128.txt', 'redcanaryco-atomic-red-team-22dd2fb/atomics/T1016/src/qakbot.bat' ] ) ] \"\"\" self . __config_file = self . __load_config ( config_file ) self . techniques = techniques self . test_guids = test_guids self . select_tests = select_tests self . __host_list = [] if host_list : for host in self . parse_input_lists ( host_list ): self . __host_list . append ( self . __create_remote_host_object ( hostname = host , username = username , password = password , ssh_key_path = ssh_key_path , private_key_string = private_key_string , verify_ssl = verify_ssl , ssh_port = ssh_port , ssh_timeout = ssh_timeout )) get_inputs ( self , guid ) Retrieves any defined inputs for a given atomic test GUID Parameters: Name Type Description Default guid str An Atomic test GUID required Returns: Type Description dict A dictionary of defined input arguments or empty Source code in atomic_operator/configparser.py def get_inputs ( self , guid : str ): \"\"\"Retrieves any defined inputs for a given atomic test GUID Args: guid (str): An Atomic test GUID Returns: dict: A dictionary of defined input arguments or empty \"\"\" if self . __config_file : for item in self . __config_file [ 'atomic_tests' ]: if item [ 'guid' ] == guid : return item . get ( 'input_arguments' , {}) return {} is_defined ( self , guid ) Checks to see if a GUID is defined within a config file Parameters: Name Type Description Default guid str The GUID defined within a parsed config file required Returns: Type Description [bool] Returns True if GUID is defined within parsed config_file Source code in atomic_operator/configparser.py def is_defined ( self , guid : str ): \"\"\"Checks to see if a GUID is defined within a config file Args: guid (str): The GUID defined within a parsed config file Returns: [bool]: Returns True if GUID is defined within parsed config_file \"\"\" if self . __config_file : for item in self . __config_file [ 'atomic_tests' ]: if item [ 'guid' ] == guid : return True return False Config The main configuration class used across atomic-operator Exceptions: Type Description AtomicsFolderNotFound Raised when unable to find the provided atomics_path value __init__ ( self , atomics_path , check_prereqs = False , get_prereqs = False , cleanup = False , command_timeout = 20 , debug = False , prompt_for_input_args = False , kwargs = {}, copy_source_files = True ) special Method generated by attrs for class Config. Source code in atomic_operator/models.py def __init__ ( self , atomics_path , check_prereqs = attr_dict [ 'check_prereqs' ] . default , get_prereqs = attr_dict [ 'get_prereqs' ] . default , cleanup = attr_dict [ 'cleanup' ] . default , command_timeout = attr_dict [ 'command_timeout' ] . default , debug = attr_dict [ 'debug' ] . default , prompt_for_input_args = attr_dict [ 'prompt_for_input_args' ] . default , kwargs = attr_dict [ 'kwargs' ] . default , copy_source_files = attr_dict [ 'copy_source_files' ] . default ): _setattr = _cached_setattr . __get__ ( self , self . __class__ ) _inst_dict = self . __dict__ _inst_dict [ 'atomics_path' ] = atomics_path _inst_dict [ 'check_prereqs' ] = check_prereqs _inst_dict [ 'get_prereqs' ] = get_prereqs _inst_dict [ 'cleanup' ] = cleanup _inst_dict [ 'command_timeout' ] = command_timeout _inst_dict [ 'debug' ] = debug _inst_dict [ 'prompt_for_input_args' ] = prompt_for_input_args _inst_dict [ 'kwargs' ] = kwargs _inst_dict [ 'copy_source_files' ] = copy_source_files if _config . _run_validators is True : __attr_validator_atomics_path ( self , __attr_atomics_path , self . atomics_path ) self . __attrs_post_init__ () Host __init__ ( self , hostname , username = None , password = None , verify_ssl = False , ssh_key_path = None , private_key_string = None , port = 22 , timeout = 5 ) special Method generated by attrs for class Host. Source code in atomic_operator/models.py def __init__ ( self , hostname , username = attr_dict [ 'username' ] . default , password = attr_dict [ 'password' ] . default , verify_ssl = attr_dict [ 'verify_ssl' ] . default , ssh_key_path = attr_dict [ 'ssh_key_path' ] . default , private_key_string = attr_dict [ 'private_key_string' ] . default , port = attr_dict [ 'port' ] . default , timeout = attr_dict [ 'timeout' ] . default ): self . hostname = hostname self . username = username self . password = password self . verify_ssl = verify_ssl self . ssh_key_path = ssh_key_path self . private_key_string = private_key_string self . port = port self . timeout = timeout if _config . _run_validators is True : __attr_validator_ssh_key_path ( self , __attr_ssh_key_path , self . ssh_key_path ) Atomic A single Atomic data structure. Each Atomic (technique) will contain a list of one or more AtomicTest objects. __init__ ( self , attack_technique , display_name , path , atomic_tests , hosts = None ) special Method generated by attrs for class Atomic. Source code in atomic_operator/atomic/atomic.py def __init__ ( self , attack_technique , display_name , path , atomic_tests , hosts = attr_dict [ 'hosts' ] . default ): self . attack_technique = attack_technique self . display_name = display_name self . path = path self . atomic_tests = atomic_tests self . hosts = hosts self . __attrs_post_init__ () AtomicDependency __init__ ( self , description , get_prereq_command = None , prereq_command = None ) special Method generated by attrs for class AtomicDependency. Source code in atomic_operator/atomic/atomictest.py def __init__ ( self , description , get_prereq_command = attr_dict [ 'get_prereq_command' ] . default , prereq_command = attr_dict [ 'prereq_command' ] . default ): self . description = description self . get_prereq_command = get_prereq_command self . prereq_command = prereq_command AtomicExecutor __init__ ( self , name , command , cleanup_command = None , elevation_required = False , steps = None ) special Method generated by attrs for class AtomicExecutor. Source code in atomic_operator/atomic/atomictest.py def __init__ ( self , name , command , cleanup_command = attr_dict [ 'cleanup_command' ] . default , elevation_required = attr_dict [ 'elevation_required' ] . default , steps = attr_dict [ 'steps' ] . default ): self . name = name self . command = command self . cleanup_command = cleanup_command self . elevation_required = elevation_required self . steps = steps AtomicTest A single Atomic test object structure Returns: Type Description AtomicTest A single Atomic test object __init__ ( self , name , description , supported_platforms , auto_generated_guid , executor , input_arguments = None , dependency_executor_name = None , dependencies = []) special Method generated by attrs for class AtomicTest. Source code in atomic_operator/atomic/atomictest.py def __init__ ( self , name , description , supported_platforms , auto_generated_guid , executor , input_arguments = attr_dict [ 'input_arguments' ] . default , dependency_executor_name = attr_dict [ 'dependency_executor_name' ] . default , dependencies = attr_dict [ 'dependencies' ] . default ): self . name = name self . description = description self . supported_platforms = supported_platforms self . auto_generated_guid = auto_generated_guid self . executor = executor self . input_arguments = input_arguments self . dependency_executor_name = dependency_executor_name self . dependencies = dependencies self . __attrs_post_init__ () AtomicTestInput __init__ ( self , name , description , type , default , value = None , source = None , destination = None ) special Method generated by attrs for class AtomicTestInput. Source code in atomic_operator/atomic/atomictest.py def __init__ ( self , name , description , type , default , value = attr_dict [ 'value' ] . default , source = attr_dict [ 'source' ] . default , destination = attr_dict [ 'destination' ] . default ): self . name = name self . description = description self . type = type self . default = default self . value = value self . source = source self . destination = destination Loader ( Base ) find_atomics ( self , atomics_path , pattern = '**/T*/T*.yaml' ) Attempts to find the atomics folder within the provided atomics_path Parameters: Name Type Description Default atomics_path str A path to the atomic-red-team directory required pattern str Pattern used to find atomics and their required yaml files. Defaults to ' /T /T .yaml'. '**/T*/T*.yaml' Returns: Type Description list A list of paths of all identified atomics found in the given directory Source code in atomic_operator/atomic/loader.py def find_atomics ( self , atomics_path , pattern = '**/T*/T*.yaml' ) -> list : \"\"\"Attempts to find the atomics folder within the provided atomics_path Args: atomics_path (str): A path to the atomic-red-team directory pattern (str, optional): Pattern used to find atomics and their required yaml files. Defaults to '**/T*/T*.yaml'. Returns: list: A list of paths of all identified atomics found in the given directory \"\"\" result = [] path = PurePath ( atomics_path ) for p in Path ( path ) . rglob ( pattern ): result . append ( p . resolve ()) return result load_technique ( self , path_to_dir ) Loads a provided yaml file which is typically an Atomic defintiion or configuration file. Parameters: Name Type Description Default path_to_dir str A string path to a yaml formatted file required Returns: Type Description dict Returns the loaded yaml file in a dictionary format Source code in atomic_operator/atomic/loader.py def load_technique ( self , path_to_dir ) -> dict : \"\"\"Loads a provided yaml file which is typically an Atomic defintiion or configuration file. Args: path_to_dir (str): A string path to a yaml formatted file Returns: dict: Returns the loaded yaml file in a dictionary format \"\"\" try : with open ( self . get_abs_path ( path_to_dir ), 'r' , encoding = \"utf-8\" ) as f : return yaml . safe_load ( f . read ()) except : # windows does not like get_abs_path so casting to string with open ( str ( path_to_dir ), 'r' , encoding = \"utf-8\" ) as f : return yaml . safe_load ( f . read ()) load_techniques ( self ) The main entrypoint when loading techniques from disk. Exceptions: Type Description AtomicsFolderNotFound Thrown when unable to find the folder containing Atomic tests Returns: Type Description dict A dict with the key(s) as the Atomic technique ID and the val is a list of Atomic objects. Source code in atomic_operator/atomic/loader.py def load_techniques ( self ) -> dict : \"\"\"The main entrypoint when loading techniques from disk. Raises: AtomicsFolderNotFound: Thrown when unable to find the folder containing Atomic tests Returns: dict: A dict with the key(s) as the Atomic technique ID and the val is a list of Atomic objects. \"\"\" atomics_path = Base . CONFIG . atomics_path if not os . path . exists ( self . get_abs_path ( atomics_path )): atomics_path = self . find_atomics ( self . get_abs_path ( __file__ )) if not atomics_path : raise AtomicsFolderNotFound ( 'Unable to find any atomics folder' ) else : atomics_path = self . find_atomics ( atomics_path ) if not atomics_path : raise AtomicsFolderNotFound ( 'Unable to find any atomics folder' ) for atomic_entry in atomics_path : technique = self . __get_file_name ( atomic_entry ) if not self . __techniques . get ( technique ): loaded_technique = self . load_technique ( str ( atomic_entry )) loaded_technique . update ({ 'path' : os . path . dirname ( str ( atomic_entry ))}) self . __techniques [ technique ] = Atomic ( ** loaded_technique ) return self . __techniques","title":"Atomic Operator"},{"location":"atomic-operator-ref/#atomic_operator.atomic_operator.AtomicOperator","text":"Main class used to run Atomic Red Team tests. atomic-operator is used to run Atomic Red Team tests both locally and remotely. These tests (atomics) are predefined tests to mock or emulate a specific technique. config_file definition: atomic-operator's run method can be supplied with a path to a configuration file (config_file) which defines specific tests and/or values for input parameters to facilitate automation of said tests. An example of this config_file can be seen below: inventory: linux1: executor: ssh authentication: username: root password: UR4Swimlane! #ssk_key_path: port: 22 timeout: 5 hosts: # - 192.168.1.1 - 10.32.100.199 # etc. atomic_tests: - guid: f7e6ec05-c19e-4a80-a7e7-241027992fdb input_arguments: output_file: value: custom_output.txt input_file: value: custom_input.txt - guid: 3ff64f0b-3af2-3866-339d-38d9791407c3 input_arguments: second_arg: value: SWAPPPED argument - guid: 32f90516-4bc9-43bd-b18d-2cbe0b7ca9b2 inventories: - linux1 Exceptions: Type Description ValueError If a provided technique is unknown we raise an error.","title":"AtomicOperator"},{"location":"atomic-operator-ref/#atomic_operator.atomic_operator.AtomicOperator.get_atomics","text":"Downloads the RedCanary atomic-red-team repository to your local system. Parameters: Name Type Description Default desintation str A folder path to download the repositorty data to. Defaults to os.getcwd(). '/home/runner/work/atomic-operator/atomic-operator' kwargs dict This kwargs will be passed along to Python requests library during download. Defaults to None. {} Returns: Type Description str The path the data can be found at. Source code in atomic_operator/atomic_operator.py def get_atomics ( self , desintation = os . getcwd (), ** kwargs ): \"\"\"Downloads the RedCanary atomic-red-team repository to your local system. Args: desintation (str, optional): A folder path to download the repositorty data to. Defaults to os.getcwd(). kwargs (dict, optional): This kwargs will be passed along to Python requests library during download. Defaults to None. Returns: str: The path the data can be found at. \"\"\" if not os . path . exists ( desintation ): os . makedirs ( desintation ) desintation = kwargs . pop ( 'destination' ) if kwargs . get ( 'destination' ) else desintation folder_name = self . download_atomic_red_team_repo ( save_path = desintation , ** kwargs ) return os . path . join ( desintation , folder_name )","title":"get_atomics()"},{"location":"atomic-operator-ref/#atomic_operator.atomic_operator.AtomicOperator.run","text":"The main method in which we run Atomic Red Team tests. Parameters: Name Type Description Default techniques list One or more defined techniques by attack_technique ID. Defaults to 'all'. ['all'] test_guids list One or more Atomic test GUIDs. Defaults to None. [] select_tests bool Select one or more tests from provided techniques. Defaults to False. False atomics_path str The path of Atomic tests. Defaults to os.getcwd(). '/home/runner/work/atomic-operator/atomic-operator' check_prereqs bool Whether or not to check for prereq dependencies (prereq_comand). Defaults to False. False get_prereqs bool Whether or not you want to retrieve prerequisites. Defaults to False. False cleanup bool Whether or not you want to run cleanup command(s). Defaults to False. False copy_source_files bool Whether or not you want to copy any related source (src, bin, etc.) files to a remote host. Defaults to True. True command_timeout int Timeout duration for each command. Defaults to 20. 20 debug bool Whether or not you want to output details about tests being ran. Defaults to False. False prompt_for_input_args bool Whether you want to prompt for input arguments for each test. Defaults to False. False return_atomics bool Whether or not you want to return atomics instead of running them. Defaults to False. False config_file str A path to a conifg_file which is used to automate atomic-operator in environments. Default to None. None config_file_only bool Whether or not you want to run tests based on the provided config_file only. Defaults to False. False hosts list A list of one or more remote hosts to run a test on. Defaults to []. [] username str Username for authentication of remote connections. Defaults to None. None password str Password for authentication of remote connections. Defaults to None. None ssh_key_path str Path to a SSH Key for authentication of remote connections. Defaults to None. None private_key_string str A private SSH Key string used for authentication of remote connections. Defaults to None. None verify_ssl bool Whether or not to verify ssl when connecting over RDP (windows). Defaults to False. False ssh_port int SSH port for authentication of remote connections. Defaults to 22. 22 ssh_timeout int SSH timeout for authentication of remote connections. Defaults to 5. 5 kwargs dict If provided, keys matching inputs for a test will be replaced. Default is None. {} Exceptions: Type Description ValueError If a provided technique is unknown we raise an error. Source code in atomic_operator/atomic_operator.py def run ( self , techniques : list = [ 'all' ], test_guids : list = [], select_tests = False , atomics_path = os . getcwd (), check_prereqs = False , get_prereqs = False , cleanup = False , copy_source_files = True , command_timeout = 20 , debug = False , prompt_for_input_args = False , return_atomics = False , config_file = None , config_file_only = False , hosts = [], username = None , password = None , ssh_key_path = None , private_key_string = None , verify_ssl = False , ssh_port = 22 , ssh_timeout = 5 , * args , ** kwargs ) -> None : \"\"\"The main method in which we run Atomic Red Team tests. Args: techniques (list, optional): One or more defined techniques by attack_technique ID. Defaults to 'all'. test_guids (list, optional): One or more Atomic test GUIDs. Defaults to None. select_tests (bool, optional): Select one or more tests from provided techniques. Defaults to False. atomics_path (str, optional): The path of Atomic tests. Defaults to os.getcwd(). check_prereqs (bool, optional): Whether or not to check for prereq dependencies (prereq_comand). Defaults to False. get_prereqs (bool, optional): Whether or not you want to retrieve prerequisites. Defaults to False. cleanup (bool, optional): Whether or not you want to run cleanup command(s). Defaults to False. copy_source_files (bool, optional): Whether or not you want to copy any related source (src, bin, etc.) files to a remote host. Defaults to True. command_timeout (int, optional): Timeout duration for each command. Defaults to 20. debug (bool, optional): Whether or not you want to output details about tests being ran. Defaults to False. prompt_for_input_args (bool, optional): Whether you want to prompt for input arguments for each test. Defaults to False. return_atomics (bool, optional): Whether or not you want to return atomics instead of running them. Defaults to False. config_file (str, optional): A path to a conifg_file which is used to automate atomic-operator in environments. Default to None. config_file_only (bool, optional): Whether or not you want to run tests based on the provided config_file only. Defaults to False. hosts (list, optional): A list of one or more remote hosts to run a test on. Defaults to []. username (str, optional): Username for authentication of remote connections. Defaults to None. password (str, optional): Password for authentication of remote connections. Defaults to None. ssh_key_path (str, optional): Path to a SSH Key for authentication of remote connections. Defaults to None. private_key_string (str, optional): A private SSH Key string used for authentication of remote connections. Defaults to None. verify_ssl (bool, optional): Whether or not to verify ssl when connecting over RDP (windows). Defaults to False. ssh_port (int, optional): SSH port for authentication of remote connections. Defaults to 22. ssh_timeout (int, optional): SSH timeout for authentication of remote connections. Defaults to 5. kwargs (dict, optional): If provided, keys matching inputs for a test will be replaced. Default is None. Raises: ValueError: If a provided technique is unknown we raise an error. \"\"\" response = self . __check_arguments ( kwargs , self . run ) if response : return response if kwargs . get ( 'help' ): return self . help ( method = 'run' ) if debug : import logging logging . getLogger () . setLevel ( logging . DEBUG ) count = 0 if check_prereqs : count += 1 if get_prereqs : count += 1 if cleanup : count += 1 if count > 1 : return IncorrectParameters ( f \"You have passed in incompatible arguments. Please only provide one of 'check_prereqs','get_prereqs','cleanup'.\" ) atomics_path = self . __find_path ( atomics_path ) if not atomics_path : return AtomicsFolderNotFound ( 'Unable to find a folder containing Atomics. Please provide a path or run get_atomics.' ) Base . CONFIG = Config ( atomics_path = atomics_path , check_prereqs = check_prereqs , get_prereqs = get_prereqs , cleanup = cleanup , command_timeout = command_timeout , debug = debug , prompt_for_input_args = prompt_for_input_args , kwargs = kwargs , copy_source_files = copy_source_files ) # taking inputs from both config_file and passed in values via command # line to build a run_list of objects self . __config_parser = ConfigParser ( config_file = config_file , techniques = None if config_file_only else self . parse_input_lists ( techniques ), test_guids = None if config_file_only else self . parse_input_lists ( test_guids ), host_list = None if config_file_only else self . parse_input_lists ( hosts ), username = username , password = password , ssh_key_path = ssh_key_path , private_key_string = private_key_string , verify_ssl = verify_ssl , ssh_port = ssh_port , ssh_timeout = ssh_timeout , select_tests = select_tests ) self . __run_list = self . __config_parser . run_list __return_atomics = [] for item in self . __run_list : if return_atomics : __return_atomics . append ( item ) elif kwargs . get ( 'kwargs' ): self . __run_technique ( item , ** kwargs . get ( 'kwargs' )) else : self . __run_technique ( item ) if return_atomics and __return_atomics : return __return_atomics return self . __test_responses","title":"run()"},{"location":"atomic-operator-ref/#atomic_operator.base.Base","text":"","title":"Base"},{"location":"atomic-operator-ref/#atomic_operator.base.Base.download_atomic_red_team_repo","text":"Downloads the Atomic Red Team repository from github Parameters: Name Type Description Default save_path str The path to save the downloaded and extracted ZIP contents required Returns: Type Description str A string of the location the data was saved to. Source code in atomic_operator/base.py def download_atomic_red_team_repo ( self , save_path , ** kwargs ) -> str : \"\"\"Downloads the Atomic Red Team repository from github Args: save_path (str): The path to save the downloaded and extracted ZIP contents Returns: str: A string of the location the data was saved to. \"\"\" response = requests . get ( Base . ATOMIC_RED_TEAM_REPO , stream = True , ** kwargs ) z = zipfile . ZipFile ( BytesIO ( response . content )) with zipfile . ZipFile ( BytesIO ( response . content )) as zf : for member in zf . infolist (): file_path = os . path . realpath ( os . path . join ( save_path , member . filename )) if file_path . startswith ( os . path . realpath ( save_path )): zf . extract ( member , save_path ) return z . namelist ()[ 0 ]","title":"download_atomic_red_team_repo()"},{"location":"atomic-operator-ref/#atomic_operator.base.Base.get_abs_path","text":"Formats and returns the absolute path for a path value Parameters: Name Type Description Default value str A path string in many different accepted formats required Returns: Type Description str The absolute path of the provided string Source code in atomic_operator/base.py def get_abs_path ( self , value ) -> str : \"\"\"Formats and returns the absolute path for a path value Args: value (str): A path string in many different accepted formats Returns: str: The absolute path of the provided string \"\"\" return os . path . abspath ( os . path . expanduser ( os . path . expandvars ( value )))","title":"get_abs_path()"},{"location":"atomic-operator-ref/#atomic_operator.base.Base.get_local_system_platform","text":"Identifies the local systems operating system platform Returns: Type Description str The current/local systems operating system platform Source code in atomic_operator/base.py def get_local_system_platform ( self ) -> str : \"\"\"Identifies the local systems operating system platform Returns: str: The current/local systems operating system platform \"\"\" os_name = platform . system () . lower () if os_name == \"darwin\" : return \"macos\" return os_name","title":"get_local_system_platform()"},{"location":"atomic-operator-ref/#atomic_operator.base.Base.prompt_user_for_input","text":"Prompts user for input values based on the provided values. Source code in atomic_operator/base.py def prompt_user_for_input ( self , title , input_object ): \"\"\"Prompts user for input values based on the provided values. \"\"\" print ( f \"\"\" Inputs for { title } : Input Name: { input_object . name } Default: { input_object . default } Description: { input_object . description } \"\"\" ) print ( f \"Please provide a value for { input_object . name } (If blank, default is used):\" ,) value = sys . stdin . readline () if bool ( value ): return value return input_object . default","title":"prompt_user_for_input()"},{"location":"atomic-operator-ref/#atomic_operator.configparser.ConfigParser","text":"","title":"ConfigParser"},{"location":"atomic-operator-ref/#atomic_operator.configparser.ConfigParser.config","text":"Returns raw converted config_file passed into class Returns: Type Description [dict] Returns the converted config_file as dictionary.","title":"config"},{"location":"atomic-operator-ref/#atomic_operator.configparser.ConfigParser.run_list","text":"Returns a list of Atomic objects that will be ran. This list combines Atomics and potentially filters tests defined within that Atomic object based on passed in parameters and config_file. Additionally, a list of Host objects are added to their defined techniques or test_guids based on config and/or passed in parameters. [ Atomic( attack_technique='T1016', display_name='System Network Configuration Discovery', path='/Users/josh.rickard/_Swimlane2/atomic-operator/redcanaryco-atomic-red-team-22dd2fb/atomics/T1016', atomic_tests=[ AtomicTest( name='System Network Configuration Discovery', description='Identify network configuration information. Upon successful execution, ...', supported_platforms=['macos', 'linux'], auto_generated_guid='c141bbdb-7fca-4254-9fd6-f47e79447e17', executor=AtomicExecutor( name='sh', command='if [ -x \"$(command -v arp)\" ]; then arp -a; else echo \"arp is missing from ....', cleanup_command=None, elevation_required=False, steps=None ), input_arguments=None, dependency_executor_name=None, dependencies=[] ) ], hosts=[ Host( hostname='192.168.1.1', username='username', password='some_passowrd!', verify_ssl=False, ssh_key_path=None, private_key_string=None, port=22, timeout=5 ) ], supporting_files=[ 'redcanaryco-atomic-red-team-22dd2fb/atomics/T1016/src/top-128.txt', 'redcanaryco-atomic-red-team-22dd2fb/atomics/T1016/src/qakbot.bat' ] ) ] !!! returns [list]: A list of modified Atomic objects that will be used to run either remotely or locally.","title":"run_list"},{"location":"atomic-operator-ref/#atomic_operator.configparser.ConfigParser.__init__","text":"Parses a provided config file as well as parameters to build a run list This list combines Atomics and potentially filters tests defined within that Atomic object based on passed in parameters and config_file. Additionally, a list of Host objects are added to their defined techniques or test_guids based on config and/or passed in parameters. Example: Example structure returned from provided values [ Atomic( attack_technique='T1016', display_name='System Network Configuration Discovery', path='/Users/josh.rickard/_Swimlane2/atomic-operator/redcanaryco-atomic-red-team-22dd2fb/atomics/T1016', atomic_tests=[ AtomicTest( name='System Network Configuration Discovery', description='Identify network configuration information. Upon successful execution, ...', supported_platforms=['macos', 'linux'], auto_generated_guid='c141bbdb-7fca-4254-9fd6-f47e79447e17', executor=AtomicExecutor( name='sh', command='if [ -x \"$(command -v arp)\" ]; then arp -a; else echo \"arp is missing from ....', cleanup_command=None, elevation_required=False, steps=None ), input_arguments=None, dependency_executor_name=None, dependencies=[] ) ], hosts=[ Host( hostname='192.168.1.1', username='username', password='some_passowrd!', verify_ssl=False, ssh_key_path=None, private_key_string=None, port=22, timeout=5 ) ], supporting_files=[ 'redcanaryco-atomic-red-team-22dd2fb/atomics/T1016/src/top-128.txt', 'redcanaryco-atomic-red-team-22dd2fb/atomics/T1016/src/qakbot.bat' ] ) ] Source code in atomic_operator/configparser.py def __init__ ( self , config_file = None , techniques = None , test_guids = None , host_list = None , username = None , password = None , ssh_key_path = None , private_key_string = None , verify_ssl = False , ssh_port = 22 , ssh_timeout = 5 , select_tests = False ): \"\"\"Parses a provided config file as well as parameters to build a run list This list combines Atomics and potentially filters tests defined within that Atomic object based on passed in parameters and config_file. Additionally, a list of Host objects are added to their defined techniques or test_guids based on config and/or passed in parameters. Example: Example structure returned from provided values [ Atomic( attack_technique='T1016', display_name='System Network Configuration Discovery', path='/Users/josh.rickard/_Swimlane2/atomic-operator/redcanaryco-atomic-red-team-22dd2fb/atomics/T1016', atomic_tests=[ AtomicTest( name='System Network Configuration Discovery', description='Identify network configuration information.\\n\\nUpon successful execution, ...', supported_platforms=['macos', 'linux'], auto_generated_guid='c141bbdb-7fca-4254-9fd6-f47e79447e17', executor=AtomicExecutor( name='sh', command='if [ -x \"$(command -v arp)\" ]; then arp -a; else echo \"arp is missing from ....', cleanup_command=None, elevation_required=False, steps=None ), input_arguments=None, dependency_executor_name=None, dependencies=[] ) ], hosts=[ Host( hostname='192.168.1.1', username='username', password='some_passowrd!', verify_ssl=False, ssh_key_path=None, private_key_string=None, port=22, timeout=5 ) ], supporting_files=[ 'redcanaryco-atomic-red-team-22dd2fb/atomics/T1016/src/top-128.txt', 'redcanaryco-atomic-red-team-22dd2fb/atomics/T1016/src/qakbot.bat' ] ) ] \"\"\" self . __config_file = self . __load_config ( config_file ) self . techniques = techniques self . test_guids = test_guids self . select_tests = select_tests self . __host_list = [] if host_list : for host in self . parse_input_lists ( host_list ): self . __host_list . append ( self . __create_remote_host_object ( hostname = host , username = username , password = password , ssh_key_path = ssh_key_path , private_key_string = private_key_string , verify_ssl = verify_ssl , ssh_port = ssh_port , ssh_timeout = ssh_timeout ))","title":"__init__()"},{"location":"atomic-operator-ref/#atomic_operator.configparser.ConfigParser.get_inputs","text":"Retrieves any defined inputs for a given atomic test GUID Parameters: Name Type Description Default guid str An Atomic test GUID required Returns: Type Description dict A dictionary of defined input arguments or empty Source code in atomic_operator/configparser.py def get_inputs ( self , guid : str ): \"\"\"Retrieves any defined inputs for a given atomic test GUID Args: guid (str): An Atomic test GUID Returns: dict: A dictionary of defined input arguments or empty \"\"\" if self . __config_file : for item in self . __config_file [ 'atomic_tests' ]: if item [ 'guid' ] == guid : return item . get ( 'input_arguments' , {}) return {}","title":"get_inputs()"},{"location":"atomic-operator-ref/#atomic_operator.configparser.ConfigParser.is_defined","text":"Checks to see if a GUID is defined within a config file Parameters: Name Type Description Default guid str The GUID defined within a parsed config file required Returns: Type Description [bool] Returns True if GUID is defined within parsed config_file Source code in atomic_operator/configparser.py def is_defined ( self , guid : str ): \"\"\"Checks to see if a GUID is defined within a config file Args: guid (str): The GUID defined within a parsed config file Returns: [bool]: Returns True if GUID is defined within parsed config_file \"\"\" if self . __config_file : for item in self . __config_file [ 'atomic_tests' ]: if item [ 'guid' ] == guid : return True return False","title":"is_defined()"},{"location":"atomic-operator-ref/#atomic_operator.models.Config","text":"The main configuration class used across atomic-operator Exceptions: Type Description AtomicsFolderNotFound Raised when unable to find the provided atomics_path value","title":"Config"},{"location":"atomic-operator-ref/#atomic_operator.models.Config.__init__","text":"Method generated by attrs for class Config. Source code in atomic_operator/models.py def __init__ ( self , atomics_path , check_prereqs = attr_dict [ 'check_prereqs' ] . default , get_prereqs = attr_dict [ 'get_prereqs' ] . default , cleanup = attr_dict [ 'cleanup' ] . default , command_timeout = attr_dict [ 'command_timeout' ] . default , debug = attr_dict [ 'debug' ] . default , prompt_for_input_args = attr_dict [ 'prompt_for_input_args' ] . default , kwargs = attr_dict [ 'kwargs' ] . default , copy_source_files = attr_dict [ 'copy_source_files' ] . default ): _setattr = _cached_setattr . __get__ ( self , self . __class__ ) _inst_dict = self . __dict__ _inst_dict [ 'atomics_path' ] = atomics_path _inst_dict [ 'check_prereqs' ] = check_prereqs _inst_dict [ 'get_prereqs' ] = get_prereqs _inst_dict [ 'cleanup' ] = cleanup _inst_dict [ 'command_timeout' ] = command_timeout _inst_dict [ 'debug' ] = debug _inst_dict [ 'prompt_for_input_args' ] = prompt_for_input_args _inst_dict [ 'kwargs' ] = kwargs _inst_dict [ 'copy_source_files' ] = copy_source_files if _config . _run_validators is True : __attr_validator_atomics_path ( self , __attr_atomics_path , self . atomics_path ) self . __attrs_post_init__ ()","title":"__init__()"},{"location":"atomic-operator-ref/#atomic_operator.models.Host","text":"","title":"Host"},{"location":"atomic-operator-ref/#atomic_operator.models.Host.__init__","text":"Method generated by attrs for class Host. Source code in atomic_operator/models.py def __init__ ( self , hostname , username = attr_dict [ 'username' ] . default , password = attr_dict [ 'password' ] . default , verify_ssl = attr_dict [ 'verify_ssl' ] . default , ssh_key_path = attr_dict [ 'ssh_key_path' ] . default , private_key_string = attr_dict [ 'private_key_string' ] . default , port = attr_dict [ 'port' ] . default , timeout = attr_dict [ 'timeout' ] . default ): self . hostname = hostname self . username = username self . password = password self . verify_ssl = verify_ssl self . ssh_key_path = ssh_key_path self . private_key_string = private_key_string self . port = port self . timeout = timeout if _config . _run_validators is True : __attr_validator_ssh_key_path ( self , __attr_ssh_key_path , self . ssh_key_path )","title":"__init__()"},{"location":"atomic-operator-ref/#atomic_operator.atomic.atomic.Atomic","text":"A single Atomic data structure. Each Atomic (technique) will contain a list of one or more AtomicTest objects.","title":"Atomic"},{"location":"atomic-operator-ref/#atomic_operator.atomic.atomic.Atomic.__init__","text":"Method generated by attrs for class Atomic. Source code in atomic_operator/atomic/atomic.py def __init__ ( self , attack_technique , display_name , path , atomic_tests , hosts = attr_dict [ 'hosts' ] . default ): self . attack_technique = attack_technique self . display_name = display_name self . path = path self . atomic_tests = atomic_tests self . hosts = hosts self . __attrs_post_init__ ()","title":"__init__()"},{"location":"atomic-operator-ref/#atomic_operator.atomic.atomictest.AtomicDependency","text":"","title":"AtomicDependency"},{"location":"atomic-operator-ref/#atomic_operator.atomic.atomictest.AtomicDependency.__init__","text":"Method generated by attrs for class AtomicDependency. Source code in atomic_operator/atomic/atomictest.py def __init__ ( self , description , get_prereq_command = attr_dict [ 'get_prereq_command' ] . default , prereq_command = attr_dict [ 'prereq_command' ] . default ): self . description = description self . get_prereq_command = get_prereq_command self . prereq_command = prereq_command","title":"__init__()"},{"location":"atomic-operator-ref/#atomic_operator.atomic.atomictest.AtomicExecutor","text":"","title":"AtomicExecutor"},{"location":"atomic-operator-ref/#atomic_operator.atomic.atomictest.AtomicExecutor.__init__","text":"Method generated by attrs for class AtomicExecutor. Source code in atomic_operator/atomic/atomictest.py def __init__ ( self , name , command , cleanup_command = attr_dict [ 'cleanup_command' ] . default , elevation_required = attr_dict [ 'elevation_required' ] . default , steps = attr_dict [ 'steps' ] . default ): self . name = name self . command = command self . cleanup_command = cleanup_command self . elevation_required = elevation_required self . steps = steps","title":"__init__()"},{"location":"atomic-operator-ref/#atomic_operator.atomic.atomictest.AtomicTest","text":"A single Atomic test object structure Returns: Type Description AtomicTest A single Atomic test object","title":"AtomicTest"},{"location":"atomic-operator-ref/#atomic_operator.atomic.atomictest.AtomicTest.__init__","text":"Method generated by attrs for class AtomicTest. Source code in atomic_operator/atomic/atomictest.py def __init__ ( self , name , description , supported_platforms , auto_generated_guid , executor , input_arguments = attr_dict [ 'input_arguments' ] . default , dependency_executor_name = attr_dict [ 'dependency_executor_name' ] . default , dependencies = attr_dict [ 'dependencies' ] . default ): self . name = name self . description = description self . supported_platforms = supported_platforms self . auto_generated_guid = auto_generated_guid self . executor = executor self . input_arguments = input_arguments self . dependency_executor_name = dependency_executor_name self . dependencies = dependencies self . __attrs_post_init__ ()","title":"__init__()"},{"location":"atomic-operator-ref/#atomic_operator.atomic.atomictest.AtomicTestInput","text":"","title":"AtomicTestInput"},{"location":"atomic-operator-ref/#atomic_operator.atomic.atomictest.AtomicTestInput.__init__","text":"Method generated by attrs for class AtomicTestInput. Source code in atomic_operator/atomic/atomictest.py def __init__ ( self , name , description , type , default , value = attr_dict [ 'value' ] . default , source = attr_dict [ 'source' ] . default , destination = attr_dict [ 'destination' ] . default ): self . name = name self . description = description self . type = type self . default = default self . value = value self . source = source self . destination = destination","title":"__init__()"},{"location":"atomic-operator-ref/#atomic_operator.atomic.loader.Loader","text":"","title":"Loader"},{"location":"atomic-operator-ref/#atomic_operator.atomic.loader.Loader.find_atomics","text":"Attempts to find the atomics folder within the provided atomics_path Parameters: Name Type Description Default atomics_path str A path to the atomic-red-team directory required pattern str Pattern used to find atomics and their required yaml files. Defaults to ' /T /T .yaml'. '**/T*/T*.yaml' Returns: Type Description list A list of paths of all identified atomics found in the given directory Source code in atomic_operator/atomic/loader.py def find_atomics ( self , atomics_path , pattern = '**/T*/T*.yaml' ) -> list : \"\"\"Attempts to find the atomics folder within the provided atomics_path Args: atomics_path (str): A path to the atomic-red-team directory pattern (str, optional): Pattern used to find atomics and their required yaml files. Defaults to '**/T*/T*.yaml'. Returns: list: A list of paths of all identified atomics found in the given directory \"\"\" result = [] path = PurePath ( atomics_path ) for p in Path ( path ) . rglob ( pattern ): result . append ( p . resolve ()) return result","title":"find_atomics()"},{"location":"atomic-operator-ref/#atomic_operator.atomic.loader.Loader.load_technique","text":"Loads a provided yaml file which is typically an Atomic defintiion or configuration file. Parameters: Name Type Description Default path_to_dir str A string path to a yaml formatted file required Returns: Type Description dict Returns the loaded yaml file in a dictionary format Source code in atomic_operator/atomic/loader.py def load_technique ( self , path_to_dir ) -> dict : \"\"\"Loads a provided yaml file which is typically an Atomic defintiion or configuration file. Args: path_to_dir (str): A string path to a yaml formatted file Returns: dict: Returns the loaded yaml file in a dictionary format \"\"\" try : with open ( self . get_abs_path ( path_to_dir ), 'r' , encoding = \"utf-8\" ) as f : return yaml . safe_load ( f . read ()) except : # windows does not like get_abs_path so casting to string with open ( str ( path_to_dir ), 'r' , encoding = \"utf-8\" ) as f : return yaml . safe_load ( f . read ())","title":"load_technique()"},{"location":"atomic-operator-ref/#atomic_operator.atomic.loader.Loader.load_techniques","text":"The main entrypoint when loading techniques from disk. Exceptions: Type Description AtomicsFolderNotFound Thrown when unable to find the folder containing Atomic tests Returns: Type Description dict A dict with the key(s) as the Atomic technique ID and the val is a list of Atomic objects. Source code in atomic_operator/atomic/loader.py def load_techniques ( self ) -> dict : \"\"\"The main entrypoint when loading techniques from disk. Raises: AtomicsFolderNotFound: Thrown when unable to find the folder containing Atomic tests Returns: dict: A dict with the key(s) as the Atomic technique ID and the val is a list of Atomic objects. \"\"\" atomics_path = Base . CONFIG . atomics_path if not os . path . exists ( self . get_abs_path ( atomics_path )): atomics_path = self . find_atomics ( self . get_abs_path ( __file__ )) if not atomics_path : raise AtomicsFolderNotFound ( 'Unable to find any atomics folder' ) else : atomics_path = self . find_atomics ( atomics_path ) if not atomics_path : raise AtomicsFolderNotFound ( 'Unable to find any atomics folder' ) for atomic_entry in atomics_path : technique = self . __get_file_name ( atomic_entry ) if not self . __techniques . get ( technique ): loaded_technique = self . load_technique ( str ( atomic_entry )) loaded_technique . update ({ 'path' : os . path . dirname ( str ( atomic_entry ))}) self . __techniques [ technique ] = Atomic ( ** loaded_technique ) return self . __techniques","title":"load_techniques()"},{"location":"atomic-operator/","text":"Atomic Operator atomic-operator can be used on the command line or via your own scripts. This page shows how the options available within atomic-operator . Command Line You can access the general help for atomic-operator by simplying typing the following in your shell. atomic-operator Retrieving Atomic Tests In order to use atomic-operator you must have one or more atomic-red-team tests (Atomics) on your local system. atomic-operator provides you with the ability to download the Atomic Red Team repository. You can do so by running the following at the command line: atomic-operator get_atomics # You can specify the destination directory by using the --destination flag atomic-operator get_atomics --destination \"/tmp/some_directory\" Running Tests In order to run a test you must provide some additional properties (and options if desired). The main method to run tests is named run . # This will run ALL tests compatiable with your local operating system atomic-operator run --atomics-path \"/tmp/some_directory/redcanaryco-atomic-red-team-3700624\" The run command has several mandatory and optional parameters that can be used. You can see these by running the help for this command: atomic-operator run --help It will return the following: NAME atomic-operator run - The main method in which we run Atomic Red Team tests. SYNOPSIS atomic-operator run <flags> DESCRIPTION config_file definition: atomic-operator's run method can be supplied with a path to a configuration file (config_file) which defines specific tests and/or values for input parameters to facilitate automation of said tests. An example of this config_file can be seen below: inventory: windows1: executor: powershell # or cmd input: username: username password: some_passowrd! verify_ssl: false hosts: - 192.168.1.1 - 10.32.1.1 # etc linux1: executor: ssh authentication: username: username password: some_passowrd! #ssk_key_path: port: 22 timeout: 5 hosts: - 192.168.1.1 - 10.32.100.1 # etc. atomic_tests: - guid: f7e6ec05-c19e-4a80-a7e7-241027992fdb input_arguments: output_file: value: custom_output.txt input_file: value: custom_input.txt inventories: - windows1 - guid: 3ff64f0b-3af2-3866-339d-38d9791407c3 input_arguments: second_arg: value: SWAPPPED argument inventories: - windows1 - linux1 - guid: 32f90516-4bc9-43bd-b18d-2cbe0b7ca9b2 inventories: - linux1 FLAGS --techniques=TECHNIQUES One or more defined techniques by attack_technique ID. Defaults to 'All'. --test_guids=TEST_GUIDS One or more Atomic test GUIDs. Defaults to None. --atomics_path=ATOMICS_PATH The path of Atomic tests. Defaults to os.getcwd(). --check_dependencies=CHECK_DEPENDENCIES Whether or not to check for dependencies. Defaults to False. --get_prereqs=GET_PREREQS Whether or not you want to retrieve prerequisites. Defaults to False. --cleanup=CLEANUP Whether or not you want to run cleanup command(s). Defaults to False. --command_timeout=COMMAND_TIMEOUT Timeout duration for each command. Defaults to 20. --debug=DEBUG Whether or not you want to output details about tests being ran. Defaults to False. --prompt_for_input_args=PROMPT_FOR_INPUT_ARGS Whether you want to prompt for input arguments for each test. Defaults to False. --config_file=CONFIG_FILE A path to a conifg_file which is used to automate atomic-operator in environments. Default to None. Additional flags are accepted. If provided, keys matching inputs for a test will be replaced. Default is None. Running atomic-operator using a config_file In addition to the ability to pass in parameters with atomic-operator you can also pass in a path to a config_file that contains all the atomic tests and their potential inputs. You can find more information about the Configuration File here Package In additional to using atomic-operator on the command line you can import it into your own scripts/code and build further automation as needed. from atomic_operator import AtomicOperator operator = AtomicOperator() # This will download a local copy of the atomic-red-team repository print(operator.get_atomics('/tmp/some_directory')) # this will run tests on your local system operator.run( technique: str='All', test_guids: list=[], atomics_path=os.getcwd(), check_dependencies=False, get_prereqs=False, cleanup=False, command_timeout=20, debug=False, prompt_for_input_args=False, config_file=\"some_path.yaml\" **kwargs )","title":"Atomic Operator"},{"location":"atomic-operator/#atomic-operator","text":"atomic-operator can be used on the command line or via your own scripts. This page shows how the options available within atomic-operator .","title":"Atomic Operator"},{"location":"atomic-operator/#command-line","text":"You can access the general help for atomic-operator by simplying typing the following in your shell. atomic-operator","title":"Command Line"},{"location":"atomic-operator/#retrieving-atomic-tests","text":"In order to use atomic-operator you must have one or more atomic-red-team tests (Atomics) on your local system. atomic-operator provides you with the ability to download the Atomic Red Team repository. You can do so by running the following at the command line: atomic-operator get_atomics # You can specify the destination directory by using the --destination flag atomic-operator get_atomics --destination \"/tmp/some_directory\"","title":"Retrieving Atomic Tests"},{"location":"atomic-operator/#running-tests","text":"In order to run a test you must provide some additional properties (and options if desired). The main method to run tests is named run . # This will run ALL tests compatiable with your local operating system atomic-operator run --atomics-path \"/tmp/some_directory/redcanaryco-atomic-red-team-3700624\" The run command has several mandatory and optional parameters that can be used. You can see these by running the help for this command: atomic-operator run --help It will return the following: NAME atomic-operator run - The main method in which we run Atomic Red Team tests. SYNOPSIS atomic-operator run <flags> DESCRIPTION config_file definition: atomic-operator's run method can be supplied with a path to a configuration file (config_file) which defines specific tests and/or values for input parameters to facilitate automation of said tests. An example of this config_file can be seen below: inventory: windows1: executor: powershell # or cmd input: username: username password: some_passowrd! verify_ssl: false hosts: - 192.168.1.1 - 10.32.1.1 # etc linux1: executor: ssh authentication: username: username password: some_passowrd! #ssk_key_path: port: 22 timeout: 5 hosts: - 192.168.1.1 - 10.32.100.1 # etc. atomic_tests: - guid: f7e6ec05-c19e-4a80-a7e7-241027992fdb input_arguments: output_file: value: custom_output.txt input_file: value: custom_input.txt inventories: - windows1 - guid: 3ff64f0b-3af2-3866-339d-38d9791407c3 input_arguments: second_arg: value: SWAPPPED argument inventories: - windows1 - linux1 - guid: 32f90516-4bc9-43bd-b18d-2cbe0b7ca9b2 inventories: - linux1 FLAGS --techniques=TECHNIQUES One or more defined techniques by attack_technique ID. Defaults to 'All'. --test_guids=TEST_GUIDS One or more Atomic test GUIDs. Defaults to None. --atomics_path=ATOMICS_PATH The path of Atomic tests. Defaults to os.getcwd(). --check_dependencies=CHECK_DEPENDENCIES Whether or not to check for dependencies. Defaults to False. --get_prereqs=GET_PREREQS Whether or not you want to retrieve prerequisites. Defaults to False. --cleanup=CLEANUP Whether or not you want to run cleanup command(s). Defaults to False. --command_timeout=COMMAND_TIMEOUT Timeout duration for each command. Defaults to 20. --debug=DEBUG Whether or not you want to output details about tests being ran. Defaults to False. --prompt_for_input_args=PROMPT_FOR_INPUT_ARGS Whether you want to prompt for input arguments for each test. Defaults to False. --config_file=CONFIG_FILE A path to a conifg_file which is used to automate atomic-operator in environments. Default to None. Additional flags are accepted. If provided, keys matching inputs for a test will be replaced. Default is None.","title":"Running Tests"},{"location":"atomic-operator/#running-atomic-operator-using-a-config_file","text":"In addition to the ability to pass in parameters with atomic-operator you can also pass in a path to a config_file that contains all the atomic tests and their potential inputs. You can find more information about the Configuration File here","title":"Running atomic-operator using a config_file"},{"location":"atomic-operator/#package","text":"In additional to using atomic-operator on the command line you can import it into your own scripts/code and build further automation as needed. from atomic_operator import AtomicOperator operator = AtomicOperator() # This will download a local copy of the atomic-red-team repository print(operator.get_atomics('/tmp/some_directory')) # this will run tests on your local system operator.run( technique: str='All', test_guids: list=[], atomics_path=os.getcwd(), check_dependencies=False, get_prereqs=False, cleanup=False, command_timeout=20, debug=False, prompt_for_input_args=False, config_file=\"some_path.yaml\" **kwargs )","title":"Package"},{"location":"atomics/","text":"Atomics As part of the Atomic Red Team project by RedCanary , you must have these atomics on you local system. atomic-operator uses these defined MITRE ATT&CK Technique tests (atomics) to run tests on your local system. Get Atomics atomic-operator provides you with the ability to download the Atomic Red Team repository. You can do so by running the following at the command line: atomic-operator get_atomics # You can specify the destination directory by using the --destination flag atomic-operator get_atomics --destination \"/tmp/some_directory\" Secondarily, you can also just clone or download the Atomics to your local system. To clone this repository, you can run: git clone https://github.com/redcanaryco/atomic-red-team.git cd atomic-red-team You can also download this repository to your local system and extract the downloaded .zip. That's it! Once you have one or more atomics on your local system then we can begin to use atomic-operator to run these tests.","title":"Get Atomics"},{"location":"atomics/#atomics","text":"As part of the Atomic Red Team project by RedCanary , you must have these atomics on you local system. atomic-operator uses these defined MITRE ATT&CK Technique tests (atomics) to run tests on your local system.","title":"Atomics"},{"location":"atomics/#get-atomics","text":"atomic-operator provides you with the ability to download the Atomic Red Team repository. You can do so by running the following at the command line: atomic-operator get_atomics # You can specify the destination directory by using the --destination flag atomic-operator get_atomics --destination \"/tmp/some_directory\" Secondarily, you can also just clone or download the Atomics to your local system. To clone this repository, you can run: git clone https://github.com/redcanaryco/atomic-red-team.git cd atomic-red-team You can also download this repository to your local system and extract the downloaded .zip. That's it! Once you have one or more atomics on your local system then we can begin to use atomic-operator to run these tests.","title":"Get Atomics"},{"location":"execution-ref/","text":"Runner ( Base ) clean_output ( self , data ) Decodes data and strips CLI garbage from returned outputs and errors Parameters: Name Type Description Default data str A output or error returned from subprocess required Returns: Type Description str A cleaned string which will be displayed on the console and in logs Source code in atomic_operator/execution/runner.py def clean_output ( self , data ): \"\"\"Decodes data and strips CLI garbage from returned outputs and errors Args: data (str): A output or error returned from subprocess Returns: str: A cleaned string which will be displayed on the console and in logs \"\"\" if data : # Remove Windows CLI garbage data = re . sub ( r \"Microsoft\\ Windows\\ \\[version .+\\]\\r?\\nCopyright.*(\\r?\\n)+[A-Z]\\:.+?\\>\" , \"\" , data . decode ( \"utf-8\" , \"ignore\" )) # formats strings with newline and return characters return re . sub ( r \"(\\r?\\n)*[A-Z]\\:.+?\\>\" , \"\" , data ) execute ( self , host_name = 'localhost' , executor = None , host = None ) The main method which runs a single AtomicTest object on a local system. Source code in atomic_operator/execution/runner.py def execute ( self , host_name = 'localhost' , executor = None , host = None ): \"\"\"The main method which runs a single AtomicTest object on a local system. \"\"\" return_dict = {} self . __logger . debug ( f \"Using { executor } as executor.\" ) if executor : if not Base . CONFIG . check_prereqs and not Base . CONFIG . get_prereqs and not Base . CONFIG . cleanup : self . __logger . debug ( \"Running command\" ) response = self . execute_process ( command = self . test . executor . command , executor = executor , host = host , cwd = self . test_path , elevation_requred = self . test . executor . elevation_required ) return_dict . update ({ 'command' : response }) elif Base . CONFIG . check_prereqs or Base . CONFIG . get_prereqs : if self . test . dependencies : return_dict . update ( self . _run_dependencies ( host = host , executor = executor )) elif Runner . CONFIG . cleanup and self . test . executor . cleanup_command : self . __logger . debug ( \"Running cleanup command\" ) cleanup_response = self . execute_process ( command = self . test . executor . cleanup_command , executor = executor , host = host , cwd = self . test_path ) return_dict . update ({ 'cleanup' : cleanup_response }) return { host_name : return_dict } print_process_output ( self , command , return_code , output , errors ) Outputs the appropriate outputs if they exists to the console and log files Parameters: Name Type Description Default command str The command which was ran by subprocess required return_code int The return code from subprocess required output bytes Output from subprocess which is typically in bytes required errors bytes Errors from subprocess which is typically in bytes required Source code in atomic_operator/execution/runner.py def print_process_output ( self , command , return_code , output , errors ): \"\"\"Outputs the appropriate outputs if they exists to the console and log files Args: command (str): The command which was ran by subprocess return_code (int): The return code from subprocess output (bytes): Output from subprocess which is typically in bytes errors (bytes): Errors from subprocess which is typically in bytes \"\"\" return_dict = {} if return_code == 127 : return_dict [ 'error' ] = f \" \\n\\n Command Not Found: { command } returned exit code { return_code } : \\n Errors: { self . clean_output ( errors ) } /nOutput: { output } \" self . __logger . warning ( return_dict [ 'error' ]) return return_dict if output or errors : if output : return_dict [ 'output' ] = self . clean_output ( output ) self . __logger . info ( \" \\n\\n Output: {} \" . format ( return_dict [ 'output' ])) else : return_dict [ 'error' ] = f \" \\n\\n Command: { command } returned exit code { return_code } : \\n { self . clean_output ( errors ) } \" self . __logger . warning ( return_dict [ 'error' ]) else : self . __logger . info ( \"(No output)\" ) return return_dict LocalRunner ( Runner ) Runs AtomicTest objects locally __init__ ( self , atomic_test , test_path ) special A single AtomicTest object is provided and ran on the local system Parameters: Name Type Description Default atomic_test AtomicTest A single AtomicTest object. required test_path Atomic A path where the AtomicTest object resides required Source code in atomic_operator/execution/localrunner.py def __init__ ( self , atomic_test , test_path ): \"\"\"A single AtomicTest object is provided and ran on the local system Args: atomic_test (AtomicTest): A single AtomicTest object. test_path (Atomic): A path where the AtomicTest object resides \"\"\" self . test = atomic_test self . test_path = test_path self . __local_system_platform = self . get_local_system_platform () execute_process ( self , command , executor = None , host = None , cwd = None ) Executes commands using subprocess Parameters: Name Type Description Default executor str An executor or shell used to execute the provided command(s) None command str The commands to run using subprocess required cwd str A string which indicates the current working directory to run the command None Returns: Type Description tuple A tuple of either outputs or errors from subprocess Source code in atomic_operator/execution/localrunner.py def execute_process ( self , command , executor = None , host = None , cwd = None ): \"\"\"Executes commands using subprocess Args: executor (str): An executor or shell used to execute the provided command(s) command (str): The commands to run using subprocess cwd (str): A string which indicates the current working directory to run the command Returns: tuple: A tuple of either outputs or errors from subprocess \"\"\" command = self . _replace_command_string ( command , self . CONFIG . atomics_path , input_arguments = self . test . input_arguments ) p = subprocess . Popen ( executor , shell = False , stdin = subprocess . PIPE , stdout = subprocess . PIPE , stderr = subprocess . STDOUT , env = os . environ , cwd = cwd ) try : outs , errs = p . communicate ( bytes ( command , \"utf-8\" ) + b \" \\n \" , timeout = Runner . CONFIG . command_timeout ) response = self . print_process_output ( command , p . returncode , outs , errs ) return response except subprocess . TimeoutExpired as e : # Display output if it exists. if e . output : self . __logger . warning ( e . output ) if e . stdout : self . __logger . warning ( e . stdout ) if e . stderr : self . __logger . warning ( e . stderr ) self . __logger . warning ( \"Command timed out!\" ) # Kill the process. p . kill () return {} RemoteRunner ( Runner ) __init__ ( self , atomic_test , test_path ) special A single AtomicTest object is provided and ran on the local system Parameters: Name Type Description Default atomic_test AtomicTest A single AtomicTest object. required test_path Atomic A path where the AtomicTest object resides required Source code in atomic_operator/execution/remoterunner.py def __init__ ( self , atomic_test , test_path ): \"\"\"A single AtomicTest object is provided and ran on the local system Args: atomic_test (AtomicTest): A single AtomicTest object. test_path (Atomic): A path where the AtomicTest object resides \"\"\" self . test = atomic_test self . test_path = test_path execute_process ( self , command , executor = None , host = None , cwd = None , elevation_required = False ) Main method to execute commands using state machine Parameters: Name Type Description Default command str The command to run remotely on the desired systems required executor str An executor that can be passed to state machine. Defaults to None. None host str A host to run remote commands on. Defaults to None. None Source code in atomic_operator/execution/remoterunner.py def execute_process ( self , command , executor = None , host = None , cwd = None , elevation_required = False ): \"\"\"Main method to execute commands using state machine Args: command (str): The command to run remotely on the desired systems executor (str): An executor that can be passed to state machine. Defaults to None. host (str): A host to run remote commands on. Defaults to None. \"\"\" self . state = CreationState () final_state = None try : finished = False while not finished : if str ( self . state ) == 'CreationState' : self . __logger . debug ( 'Running CreationState on_event' ) self . state = self . state . on_event ( executor , command ) if str ( self . state ) == 'InnvocationState' : self . __logger . debug ( 'Running InnvocationState on_event' ) self . state = self . state . invoke ( host , executor , command , input_arguments = self . test . input_arguments , elevation_required = elevation_required ) if str ( self . state ) == 'ParseResultsState' : self . __logger . debug ( 'Running ParseResultsState on_event' ) final_state = self . state . on_event () self . __logger . info ( final_state ) finished = True except NoValidConnectionsError as ec : error_string = f 'SSH Error - Unable to connect to { host . hostname } - Received { type ( ec ) . __name__ } ' self . __logger . debug ( f 'Full stack trace: { ec } ' ) self . __logger . warning ( error_string ) return { 'error' : error_string } except AuthenticationException as ea : error_string = f 'SSH Error - Unable to authenticate to host - { host . hostname } - Received { type ( ea ) . __name__ } ' self . __logger . debug ( f 'Full stack trace: { ea } ' ) self . __logger . warning ( error_string ) return { 'error' : error_string } except BadAuthenticationType as eb : error_string = f 'SSH Error - Unable to use provided authentication type to host - { host . hostname } - Received { type ( eb ) . __name__ } ' self . __logger . debug ( f 'Full stack trace: { eb } ' ) self . __logger . warning ( error_string ) return { 'error' : error_string } except PasswordRequiredException as ep : error_string = f 'SSH Error - Must provide a password to authenticate to host - { host . hostname } - Received { type ( ep ) . __name__ } ' self . __logger . debug ( f 'Full stack trace: { ep } ' ) self . __logger . warning ( error_string ) return { 'error' : error_string } except AuthenticationError as ewa : error_string = f 'Windows Error - Unable to authenticate to host - { host . hostname } - Received { type ( ewa ) . __name__ } ' self . __logger . debug ( f 'Full stack trace: { ewa } ' ) self . __logger . warning ( error_string ) return { 'error' : error_string } except WinRMTransportError as ewt : error_string = f 'Windows Error - Error occurred during transport on host - { host . hostname } - Received { type ( ewt ) . __name__ } ' self . __logger . debug ( f 'Full stack trace: { ewt } ' ) self . __logger . warning ( error_string ) return { 'error' : error_string } except WSManFaultError as ewf : error_string = f 'Windows Error - Received WSManFault information from host - { host . hostname } - Received { type ( ewf ) . __name__ } ' self . __logger . debug ( f 'Full stack trace: { ewf } ' ) self . __logger . warning ( error_string ) return { 'error' : error_string } except RequestException as re : error_string = f 'Request Exception - Connection Error to the configured host - { host . hostname } - Received { type ( re ) . __name__ } ' self . __logger . debug ( f 'Full stack trace: { re } ' ) self . __logger . warning ( error_string ) return { 'error' : error_string } except Exception as ex : error_string = f 'Uknown Error - Received an unknown error from host - { host . hostname } - Received { type ( ex ) . __name__ } ' self . __logger . debug ( f 'Full stack trace: { ex } ' ) self . __logger . warning ( error_string ) return { 'error' : error_string } return final_state start ( self , host = None , executor = None ) The main method which runs a single AtomicTest object remotely on one remote host. Source code in atomic_operator/execution/remoterunner.py def start ( self , host = None , executor = None ): \"\"\"The main method which runs a single AtomicTest object remotely on one remote host. \"\"\" return self . execute ( host_name = host . hostname , executor = executor , host = host ) AWSRunner ( Runner ) Runs AtomicTest objects against AWS using the aws-cli __init__ ( self , atomic_test , test_path ) special A single AtomicTest object is provided and ran using the aws-cli Parameters: Name Type Description Default atomic_test AtomicTest A single AtomicTest object. required test_path Atomic A path where the AtomicTest object resides required Source code in atomic_operator/execution/awsrunner.py def __init__ ( self , atomic_test , test_path ): \"\"\"A single AtomicTest object is provided and ran using the aws-cli Args: atomic_test (AtomicTest): A single AtomicTest object. test_path (Atomic): A path where the AtomicTest object resides \"\"\" self . test = atomic_test self . test_path = test_path self . __local_system_platform = self . get_local_system_platform () execute_process ( self , command , executor = None , host = None , cwd = None ) Executes commands using subprocess Parameters: Name Type Description Default executor str An executor or shell used to execute the provided command(s) None command str The commands to run using subprocess required cwd str A string which indicates the current working directory to run the command None Returns: Type Description tuple A tuple of either outputs or errors from subprocess Source code in atomic_operator/execution/awsrunner.py def execute_process ( self , command , executor = None , host = None , cwd = None ): \"\"\"Executes commands using subprocess Args: executor (str): An executor or shell used to execute the provided command(s) command (str): The commands to run using subprocess cwd (str): A string which indicates the current working directory to run the command Returns: tuple: A tuple of either outputs or errors from subprocess \"\"\" p = subprocess . Popen ( executor , shell = False , stdin = subprocess . PIPE , stdout = subprocess . PIPE , stderr = subprocess . STDOUT , env = os . environ , cwd = cwd ) try : outs , errs = p . communicate ( bytes ( command , \"utf-8\" ) + b \" \\n \" , timeout = Runner . CONFIG . command_timeout ) response = self . print_process_output ( command , p . returncode , outs , errs ) return response except subprocess . TimeoutExpired as e : # Display output if it exists. if e . output : self . __logger . warning ( e . output ) if e . stdout : self . __logger . warning ( e . stdout ) if e . stderr : self . __logger . warning ( e . stderr ) self . __logger . warning ( \"Command timed out!\" ) # Kill the process. p . kill () return {} CreationState ( State ) The state which is used to modify commands on_event ( self , command_type , command ) Handle events that are delegated to this State. Source code in atomic_operator/execution/statemachine.py def on_event ( self , command_type , command ): if command_type == 'powershell' : return self . powershell ( command ) elif command_type == 'cmd' : return self . cmd () elif command_type == 'ssh' : return self . ssh () elif command_type == 'sh' : return self . ssh () elif command_type == 'bash' : return self . ssh () return self InnvocationState ( State , Base ) The state which indicates the invocation of a command ParseResultsState ( State , Runner ) The state which is used to parse the results on_event ( self ) Handle events that are delegated to this State. Source code in atomic_operator/execution/statemachine.py def on_event ( self ): return self . result State We define a state object which provides some utility functions for the individual states within the state machine. on_event ( self , event ) Handle events that are delegated to this State. Source code in atomic_operator/execution/statemachine.py def on_event ( self , event ): \"\"\" Handle events that are delegated to this State. \"\"\" pass SuppressFilter ( Filter ) filter ( self , record ) Determine if the specified record is to be logged. Returns True if the record should be logged, or False otherwise. If deemed appropriate, the record may be modified in-place. Source code in atomic_operator/execution/statemachine.py def filter ( self , record ): return 'wsman' not in record . getMessage ()","title":"Executors"},{"location":"execution-ref/#atomic_operator.execution.runner.Runner","text":"","title":"Runner"},{"location":"execution-ref/#atomic_operator.execution.runner.Runner.clean_output","text":"Decodes data and strips CLI garbage from returned outputs and errors Parameters: Name Type Description Default data str A output or error returned from subprocess required Returns: Type Description str A cleaned string which will be displayed on the console and in logs Source code in atomic_operator/execution/runner.py def clean_output ( self , data ): \"\"\"Decodes data and strips CLI garbage from returned outputs and errors Args: data (str): A output or error returned from subprocess Returns: str: A cleaned string which will be displayed on the console and in logs \"\"\" if data : # Remove Windows CLI garbage data = re . sub ( r \"Microsoft\\ Windows\\ \\[version .+\\]\\r?\\nCopyright.*(\\r?\\n)+[A-Z]\\:.+?\\>\" , \"\" , data . decode ( \"utf-8\" , \"ignore\" )) # formats strings with newline and return characters return re . sub ( r \"(\\r?\\n)*[A-Z]\\:.+?\\>\" , \"\" , data )","title":"clean_output()"},{"location":"execution-ref/#atomic_operator.execution.runner.Runner.execute","text":"The main method which runs a single AtomicTest object on a local system. Source code in atomic_operator/execution/runner.py def execute ( self , host_name = 'localhost' , executor = None , host = None ): \"\"\"The main method which runs a single AtomicTest object on a local system. \"\"\" return_dict = {} self . __logger . debug ( f \"Using { executor } as executor.\" ) if executor : if not Base . CONFIG . check_prereqs and not Base . CONFIG . get_prereqs and not Base . CONFIG . cleanup : self . __logger . debug ( \"Running command\" ) response = self . execute_process ( command = self . test . executor . command , executor = executor , host = host , cwd = self . test_path , elevation_requred = self . test . executor . elevation_required ) return_dict . update ({ 'command' : response }) elif Base . CONFIG . check_prereqs or Base . CONFIG . get_prereqs : if self . test . dependencies : return_dict . update ( self . _run_dependencies ( host = host , executor = executor )) elif Runner . CONFIG . cleanup and self . test . executor . cleanup_command : self . __logger . debug ( \"Running cleanup command\" ) cleanup_response = self . execute_process ( command = self . test . executor . cleanup_command , executor = executor , host = host , cwd = self . test_path ) return_dict . update ({ 'cleanup' : cleanup_response }) return { host_name : return_dict }","title":"execute()"},{"location":"execution-ref/#atomic_operator.execution.runner.Runner.print_process_output","text":"Outputs the appropriate outputs if they exists to the console and log files Parameters: Name Type Description Default command str The command which was ran by subprocess required return_code int The return code from subprocess required output bytes Output from subprocess which is typically in bytes required errors bytes Errors from subprocess which is typically in bytes required Source code in atomic_operator/execution/runner.py def print_process_output ( self , command , return_code , output , errors ): \"\"\"Outputs the appropriate outputs if they exists to the console and log files Args: command (str): The command which was ran by subprocess return_code (int): The return code from subprocess output (bytes): Output from subprocess which is typically in bytes errors (bytes): Errors from subprocess which is typically in bytes \"\"\" return_dict = {} if return_code == 127 : return_dict [ 'error' ] = f \" \\n\\n Command Not Found: { command } returned exit code { return_code } : \\n Errors: { self . clean_output ( errors ) } /nOutput: { output } \" self . __logger . warning ( return_dict [ 'error' ]) return return_dict if output or errors : if output : return_dict [ 'output' ] = self . clean_output ( output ) self . __logger . info ( \" \\n\\n Output: {} \" . format ( return_dict [ 'output' ])) else : return_dict [ 'error' ] = f \" \\n\\n Command: { command } returned exit code { return_code } : \\n { self . clean_output ( errors ) } \" self . __logger . warning ( return_dict [ 'error' ]) else : self . __logger . info ( \"(No output)\" ) return return_dict","title":"print_process_output()"},{"location":"execution-ref/#atomic_operator.execution.localrunner.LocalRunner","text":"Runs AtomicTest objects locally","title":"LocalRunner"},{"location":"execution-ref/#atomic_operator.execution.localrunner.LocalRunner.__init__","text":"A single AtomicTest object is provided and ran on the local system Parameters: Name Type Description Default atomic_test AtomicTest A single AtomicTest object. required test_path Atomic A path where the AtomicTest object resides required Source code in atomic_operator/execution/localrunner.py def __init__ ( self , atomic_test , test_path ): \"\"\"A single AtomicTest object is provided and ran on the local system Args: atomic_test (AtomicTest): A single AtomicTest object. test_path (Atomic): A path where the AtomicTest object resides \"\"\" self . test = atomic_test self . test_path = test_path self . __local_system_platform = self . get_local_system_platform ()","title":"__init__()"},{"location":"execution-ref/#atomic_operator.execution.localrunner.LocalRunner.execute_process","text":"Executes commands using subprocess Parameters: Name Type Description Default executor str An executor or shell used to execute the provided command(s) None command str The commands to run using subprocess required cwd str A string which indicates the current working directory to run the command None Returns: Type Description tuple A tuple of either outputs or errors from subprocess Source code in atomic_operator/execution/localrunner.py def execute_process ( self , command , executor = None , host = None , cwd = None ): \"\"\"Executes commands using subprocess Args: executor (str): An executor or shell used to execute the provided command(s) command (str): The commands to run using subprocess cwd (str): A string which indicates the current working directory to run the command Returns: tuple: A tuple of either outputs or errors from subprocess \"\"\" command = self . _replace_command_string ( command , self . CONFIG . atomics_path , input_arguments = self . test . input_arguments ) p = subprocess . Popen ( executor , shell = False , stdin = subprocess . PIPE , stdout = subprocess . PIPE , stderr = subprocess . STDOUT , env = os . environ , cwd = cwd ) try : outs , errs = p . communicate ( bytes ( command , \"utf-8\" ) + b \" \\n \" , timeout = Runner . CONFIG . command_timeout ) response = self . print_process_output ( command , p . returncode , outs , errs ) return response except subprocess . TimeoutExpired as e : # Display output if it exists. if e . output : self . __logger . warning ( e . output ) if e . stdout : self . __logger . warning ( e . stdout ) if e . stderr : self . __logger . warning ( e . stderr ) self . __logger . warning ( \"Command timed out!\" ) # Kill the process. p . kill () return {}","title":"execute_process()"},{"location":"execution-ref/#atomic_operator.execution.remoterunner.RemoteRunner","text":"","title":"RemoteRunner"},{"location":"execution-ref/#atomic_operator.execution.remoterunner.RemoteRunner.__init__","text":"A single AtomicTest object is provided and ran on the local system Parameters: Name Type Description Default atomic_test AtomicTest A single AtomicTest object. required test_path Atomic A path where the AtomicTest object resides required Source code in atomic_operator/execution/remoterunner.py def __init__ ( self , atomic_test , test_path ): \"\"\"A single AtomicTest object is provided and ran on the local system Args: atomic_test (AtomicTest): A single AtomicTest object. test_path (Atomic): A path where the AtomicTest object resides \"\"\" self . test = atomic_test self . test_path = test_path","title":"__init__()"},{"location":"execution-ref/#atomic_operator.execution.remoterunner.RemoteRunner.execute_process","text":"Main method to execute commands using state machine Parameters: Name Type Description Default command str The command to run remotely on the desired systems required executor str An executor that can be passed to state machine. Defaults to None. None host str A host to run remote commands on. Defaults to None. None Source code in atomic_operator/execution/remoterunner.py def execute_process ( self , command , executor = None , host = None , cwd = None , elevation_required = False ): \"\"\"Main method to execute commands using state machine Args: command (str): The command to run remotely on the desired systems executor (str): An executor that can be passed to state machine. Defaults to None. host (str): A host to run remote commands on. Defaults to None. \"\"\" self . state = CreationState () final_state = None try : finished = False while not finished : if str ( self . state ) == 'CreationState' : self . __logger . debug ( 'Running CreationState on_event' ) self . state = self . state . on_event ( executor , command ) if str ( self . state ) == 'InnvocationState' : self . __logger . debug ( 'Running InnvocationState on_event' ) self . state = self . state . invoke ( host , executor , command , input_arguments = self . test . input_arguments , elevation_required = elevation_required ) if str ( self . state ) == 'ParseResultsState' : self . __logger . debug ( 'Running ParseResultsState on_event' ) final_state = self . state . on_event () self . __logger . info ( final_state ) finished = True except NoValidConnectionsError as ec : error_string = f 'SSH Error - Unable to connect to { host . hostname } - Received { type ( ec ) . __name__ } ' self . __logger . debug ( f 'Full stack trace: { ec } ' ) self . __logger . warning ( error_string ) return { 'error' : error_string } except AuthenticationException as ea : error_string = f 'SSH Error - Unable to authenticate to host - { host . hostname } - Received { type ( ea ) . __name__ } ' self . __logger . debug ( f 'Full stack trace: { ea } ' ) self . __logger . warning ( error_string ) return { 'error' : error_string } except BadAuthenticationType as eb : error_string = f 'SSH Error - Unable to use provided authentication type to host - { host . hostname } - Received { type ( eb ) . __name__ } ' self . __logger . debug ( f 'Full stack trace: { eb } ' ) self . __logger . warning ( error_string ) return { 'error' : error_string } except PasswordRequiredException as ep : error_string = f 'SSH Error - Must provide a password to authenticate to host - { host . hostname } - Received { type ( ep ) . __name__ } ' self . __logger . debug ( f 'Full stack trace: { ep } ' ) self . __logger . warning ( error_string ) return { 'error' : error_string } except AuthenticationError as ewa : error_string = f 'Windows Error - Unable to authenticate to host - { host . hostname } - Received { type ( ewa ) . __name__ } ' self . __logger . debug ( f 'Full stack trace: { ewa } ' ) self . __logger . warning ( error_string ) return { 'error' : error_string } except WinRMTransportError as ewt : error_string = f 'Windows Error - Error occurred during transport on host - { host . hostname } - Received { type ( ewt ) . __name__ } ' self . __logger . debug ( f 'Full stack trace: { ewt } ' ) self . __logger . warning ( error_string ) return { 'error' : error_string } except WSManFaultError as ewf : error_string = f 'Windows Error - Received WSManFault information from host - { host . hostname } - Received { type ( ewf ) . __name__ } ' self . __logger . debug ( f 'Full stack trace: { ewf } ' ) self . __logger . warning ( error_string ) return { 'error' : error_string } except RequestException as re : error_string = f 'Request Exception - Connection Error to the configured host - { host . hostname } - Received { type ( re ) . __name__ } ' self . __logger . debug ( f 'Full stack trace: { re } ' ) self . __logger . warning ( error_string ) return { 'error' : error_string } except Exception as ex : error_string = f 'Uknown Error - Received an unknown error from host - { host . hostname } - Received { type ( ex ) . __name__ } ' self . __logger . debug ( f 'Full stack trace: { ex } ' ) self . __logger . warning ( error_string ) return { 'error' : error_string } return final_state","title":"execute_process()"},{"location":"execution-ref/#atomic_operator.execution.remoterunner.RemoteRunner.start","text":"The main method which runs a single AtomicTest object remotely on one remote host. Source code in atomic_operator/execution/remoterunner.py def start ( self , host = None , executor = None ): \"\"\"The main method which runs a single AtomicTest object remotely on one remote host. \"\"\" return self . execute ( host_name = host . hostname , executor = executor , host = host )","title":"start()"},{"location":"execution-ref/#atomic_operator.execution.awsrunner.AWSRunner","text":"Runs AtomicTest objects against AWS using the aws-cli","title":"AWSRunner"},{"location":"execution-ref/#atomic_operator.execution.awsrunner.AWSRunner.__init__","text":"A single AtomicTest object is provided and ran using the aws-cli Parameters: Name Type Description Default atomic_test AtomicTest A single AtomicTest object. required test_path Atomic A path where the AtomicTest object resides required Source code in atomic_operator/execution/awsrunner.py def __init__ ( self , atomic_test , test_path ): \"\"\"A single AtomicTest object is provided and ran using the aws-cli Args: atomic_test (AtomicTest): A single AtomicTest object. test_path (Atomic): A path where the AtomicTest object resides \"\"\" self . test = atomic_test self . test_path = test_path self . __local_system_platform = self . get_local_system_platform ()","title":"__init__()"},{"location":"execution-ref/#atomic_operator.execution.awsrunner.AWSRunner.execute_process","text":"Executes commands using subprocess Parameters: Name Type Description Default executor str An executor or shell used to execute the provided command(s) None command str The commands to run using subprocess required cwd str A string which indicates the current working directory to run the command None Returns: Type Description tuple A tuple of either outputs or errors from subprocess Source code in atomic_operator/execution/awsrunner.py def execute_process ( self , command , executor = None , host = None , cwd = None ): \"\"\"Executes commands using subprocess Args: executor (str): An executor or shell used to execute the provided command(s) command (str): The commands to run using subprocess cwd (str): A string which indicates the current working directory to run the command Returns: tuple: A tuple of either outputs or errors from subprocess \"\"\" p = subprocess . Popen ( executor , shell = False , stdin = subprocess . PIPE , stdout = subprocess . PIPE , stderr = subprocess . STDOUT , env = os . environ , cwd = cwd ) try : outs , errs = p . communicate ( bytes ( command , \"utf-8\" ) + b \" \\n \" , timeout = Runner . CONFIG . command_timeout ) response = self . print_process_output ( command , p . returncode , outs , errs ) return response except subprocess . TimeoutExpired as e : # Display output if it exists. if e . output : self . __logger . warning ( e . output ) if e . stdout : self . __logger . warning ( e . stdout ) if e . stderr : self . __logger . warning ( e . stderr ) self . __logger . warning ( \"Command timed out!\" ) # Kill the process. p . kill () return {}","title":"execute_process()"},{"location":"execution-ref/#atomic_operator.execution.statemachine.CreationState","text":"The state which is used to modify commands","title":"CreationState"},{"location":"execution-ref/#atomic_operator.execution.statemachine.CreationState.on_event","text":"Handle events that are delegated to this State. Source code in atomic_operator/execution/statemachine.py def on_event ( self , command_type , command ): if command_type == 'powershell' : return self . powershell ( command ) elif command_type == 'cmd' : return self . cmd () elif command_type == 'ssh' : return self . ssh () elif command_type == 'sh' : return self . ssh () elif command_type == 'bash' : return self . ssh () return self","title":"on_event()"},{"location":"execution-ref/#atomic_operator.execution.statemachine.InnvocationState","text":"The state which indicates the invocation of a command","title":"InnvocationState"},{"location":"execution-ref/#atomic_operator.execution.statemachine.ParseResultsState","text":"The state which is used to parse the results","title":"ParseResultsState"},{"location":"execution-ref/#atomic_operator.execution.statemachine.ParseResultsState.on_event","text":"Handle events that are delegated to this State. Source code in atomic_operator/execution/statemachine.py def on_event ( self ): return self . result","title":"on_event()"},{"location":"execution-ref/#atomic_operator.execution.statemachine.State","text":"We define a state object which provides some utility functions for the individual states within the state machine.","title":"State"},{"location":"execution-ref/#atomic_operator.execution.statemachine.State.on_event","text":"Handle events that are delegated to this State. Source code in atomic_operator/execution/statemachine.py def on_event ( self , event ): \"\"\" Handle events that are delegated to this State. \"\"\" pass","title":"on_event()"},{"location":"execution-ref/#atomic_operator.execution.statemachine.SuppressFilter","text":"","title":"SuppressFilter"},{"location":"execution-ref/#atomic_operator.execution.statemachine.SuppressFilter.filter","text":"Determine if the specified record is to be logged. Returns True if the record should be logged, or False otherwise. If deemed appropriate, the record may be modified in-place. Source code in atomic_operator/execution/statemachine.py def filter ( self , record ): return 'wsman' not in record . getMessage ()","title":"filter()"},{"location":"models-ref/","text":"Config The main configuration class used across atomic-operator Exceptions: Type Description AtomicsFolderNotFound Raised when unable to find the provided atomics_path value __init__ ( self , atomics_path , check_prereqs = False , get_prereqs = False , cleanup = False , command_timeout = 20 , debug = False , prompt_for_input_args = False , kwargs = {}, copy_source_files = True ) special Method generated by attrs for class Config. Source code in atomic_operator/models.py def __init__ ( self , atomics_path , check_prereqs = attr_dict [ 'check_prereqs' ] . default , get_prereqs = attr_dict [ 'get_prereqs' ] . default , cleanup = attr_dict [ 'cleanup' ] . default , command_timeout = attr_dict [ 'command_timeout' ] . default , debug = attr_dict [ 'debug' ] . default , prompt_for_input_args = attr_dict [ 'prompt_for_input_args' ] . default , kwargs = attr_dict [ 'kwargs' ] . default , copy_source_files = attr_dict [ 'copy_source_files' ] . default ): _setattr = _cached_setattr . __get__ ( self , self . __class__ ) _inst_dict = self . __dict__ _inst_dict [ 'atomics_path' ] = atomics_path _inst_dict [ 'check_prereqs' ] = check_prereqs _inst_dict [ 'get_prereqs' ] = get_prereqs _inst_dict [ 'cleanup' ] = cleanup _inst_dict [ 'command_timeout' ] = command_timeout _inst_dict [ 'debug' ] = debug _inst_dict [ 'prompt_for_input_args' ] = prompt_for_input_args _inst_dict [ 'kwargs' ] = kwargs _inst_dict [ 'copy_source_files' ] = copy_source_files if _config . _run_validators is True : __attr_validator_atomics_path ( self , __attr_atomics_path , self . atomics_path ) self . __attrs_post_init__ () Host __init__ ( self , hostname , username = None , password = None , verify_ssl = False , ssh_key_path = None , private_key_string = None , port = 22 , timeout = 5 ) special Method generated by attrs for class Host. Source code in atomic_operator/models.py def __init__ ( self , hostname , username = attr_dict [ 'username' ] . default , password = attr_dict [ 'password' ] . default , verify_ssl = attr_dict [ 'verify_ssl' ] . default , ssh_key_path = attr_dict [ 'ssh_key_path' ] . default , private_key_string = attr_dict [ 'private_key_string' ] . default , port = attr_dict [ 'port' ] . default , timeout = attr_dict [ 'timeout' ] . default ): self . hostname = hostname self . username = username self . password = password self . verify_ssl = verify_ssl self . ssh_key_path = ssh_key_path self . private_key_string = private_key_string self . port = port self . timeout = timeout if _config . _run_validators is True : __attr_validator_ssh_key_path ( self , __attr_ssh_key_path , self . ssh_key_path ) Atomic A single Atomic data structure. Each Atomic (technique) will contain a list of one or more AtomicTest objects. __init__ ( self , attack_technique , display_name , path , atomic_tests , hosts = None ) special Method generated by attrs for class Atomic. Source code in atomic_operator/atomic/atomic.py def __init__ ( self , attack_technique , display_name , path , atomic_tests , hosts = attr_dict [ 'hosts' ] . default ): self . attack_technique = attack_technique self . display_name = display_name self . path = path self . atomic_tests = atomic_tests self . hosts = hosts self . __attrs_post_init__ () AtomicDependency __init__ ( self , description , get_prereq_command = None , prereq_command = None ) special Method generated by attrs for class AtomicDependency. Source code in atomic_operator/atomic/atomictest.py def __init__ ( self , description , get_prereq_command = attr_dict [ 'get_prereq_command' ] . default , prereq_command = attr_dict [ 'prereq_command' ] . default ): self . description = description self . get_prereq_command = get_prereq_command self . prereq_command = prereq_command AtomicExecutor __init__ ( self , name , command , cleanup_command = None , elevation_required = False , steps = None ) special Method generated by attrs for class AtomicExecutor. Source code in atomic_operator/atomic/atomictest.py def __init__ ( self , name , command , cleanup_command = attr_dict [ 'cleanup_command' ] . default , elevation_required = attr_dict [ 'elevation_required' ] . default , steps = attr_dict [ 'steps' ] . default ): self . name = name self . command = command self . cleanup_command = cleanup_command self . elevation_required = elevation_required self . steps = steps AtomicTest A single Atomic test object structure Returns: Type Description AtomicTest A single Atomic test object __init__ ( self , name , description , supported_platforms , auto_generated_guid , executor , input_arguments = None , dependency_executor_name = None , dependencies = []) special Method generated by attrs for class AtomicTest. Source code in atomic_operator/atomic/atomictest.py def __init__ ( self , name , description , supported_platforms , auto_generated_guid , executor , input_arguments = attr_dict [ 'input_arguments' ] . default , dependency_executor_name = attr_dict [ 'dependency_executor_name' ] . default , dependencies = attr_dict [ 'dependencies' ] . default ): self . name = name self . description = description self . supported_platforms = supported_platforms self . auto_generated_guid = auto_generated_guid self . executor = executor self . input_arguments = input_arguments self . dependency_executor_name = dependency_executor_name self . dependencies = dependencies self . __attrs_post_init__ () AtomicTestInput __init__ ( self , name , description , type , default , value = None , source = None , destination = None ) special Method generated by attrs for class AtomicTestInput. Source code in atomic_operator/atomic/atomictest.py def __init__ ( self , name , description , type , default , value = attr_dict [ 'value' ] . default , source = attr_dict [ 'source' ] . default , destination = attr_dict [ 'destination' ] . default ): self . name = name self . description = description self . type = type self . default = default self . value = value self . source = source self . destination = destination","title":"Data Models"},{"location":"models-ref/#atomic_operator.models.Config","text":"The main configuration class used across atomic-operator Exceptions: Type Description AtomicsFolderNotFound Raised when unable to find the provided atomics_path value","title":"Config"},{"location":"models-ref/#atomic_operator.models.Config.__init__","text":"Method generated by attrs for class Config. Source code in atomic_operator/models.py def __init__ ( self , atomics_path , check_prereqs = attr_dict [ 'check_prereqs' ] . default , get_prereqs = attr_dict [ 'get_prereqs' ] . default , cleanup = attr_dict [ 'cleanup' ] . default , command_timeout = attr_dict [ 'command_timeout' ] . default , debug = attr_dict [ 'debug' ] . default , prompt_for_input_args = attr_dict [ 'prompt_for_input_args' ] . default , kwargs = attr_dict [ 'kwargs' ] . default , copy_source_files = attr_dict [ 'copy_source_files' ] . default ): _setattr = _cached_setattr . __get__ ( self , self . __class__ ) _inst_dict = self . __dict__ _inst_dict [ 'atomics_path' ] = atomics_path _inst_dict [ 'check_prereqs' ] = check_prereqs _inst_dict [ 'get_prereqs' ] = get_prereqs _inst_dict [ 'cleanup' ] = cleanup _inst_dict [ 'command_timeout' ] = command_timeout _inst_dict [ 'debug' ] = debug _inst_dict [ 'prompt_for_input_args' ] = prompt_for_input_args _inst_dict [ 'kwargs' ] = kwargs _inst_dict [ 'copy_source_files' ] = copy_source_files if _config . _run_validators is True : __attr_validator_atomics_path ( self , __attr_atomics_path , self . atomics_path ) self . __attrs_post_init__ ()","title":"__init__()"},{"location":"models-ref/#atomic_operator.models.Host","text":"","title":"Host"},{"location":"models-ref/#atomic_operator.models.Host.__init__","text":"Method generated by attrs for class Host. Source code in atomic_operator/models.py def __init__ ( self , hostname , username = attr_dict [ 'username' ] . default , password = attr_dict [ 'password' ] . default , verify_ssl = attr_dict [ 'verify_ssl' ] . default , ssh_key_path = attr_dict [ 'ssh_key_path' ] . default , private_key_string = attr_dict [ 'private_key_string' ] . default , port = attr_dict [ 'port' ] . default , timeout = attr_dict [ 'timeout' ] . default ): self . hostname = hostname self . username = username self . password = password self . verify_ssl = verify_ssl self . ssh_key_path = ssh_key_path self . private_key_string = private_key_string self . port = port self . timeout = timeout if _config . _run_validators is True : __attr_validator_ssh_key_path ( self , __attr_ssh_key_path , self . ssh_key_path )","title":"__init__()"},{"location":"models-ref/#atomic_operator.atomic.atomic.Atomic","text":"A single Atomic data structure. Each Atomic (technique) will contain a list of one or more AtomicTest objects.","title":"Atomic"},{"location":"models-ref/#atomic_operator.atomic.atomic.Atomic.__init__","text":"Method generated by attrs for class Atomic. Source code in atomic_operator/atomic/atomic.py def __init__ ( self , attack_technique , display_name , path , atomic_tests , hosts = attr_dict [ 'hosts' ] . default ): self . attack_technique = attack_technique self . display_name = display_name self . path = path self . atomic_tests = atomic_tests self . hosts = hosts self . __attrs_post_init__ ()","title":"__init__()"},{"location":"models-ref/#atomic_operator.atomic.atomictest.AtomicDependency","text":"","title":"AtomicDependency"},{"location":"models-ref/#atomic_operator.atomic.atomictest.AtomicDependency.__init__","text":"Method generated by attrs for class AtomicDependency. Source code in atomic_operator/atomic/atomictest.py def __init__ ( self , description , get_prereq_command = attr_dict [ 'get_prereq_command' ] . default , prereq_command = attr_dict [ 'prereq_command' ] . default ): self . description = description self . get_prereq_command = get_prereq_command self . prereq_command = prereq_command","title":"__init__()"},{"location":"models-ref/#atomic_operator.atomic.atomictest.AtomicExecutor","text":"","title":"AtomicExecutor"},{"location":"models-ref/#atomic_operator.atomic.atomictest.AtomicExecutor.__init__","text":"Method generated by attrs for class AtomicExecutor. Source code in atomic_operator/atomic/atomictest.py def __init__ ( self , name , command , cleanup_command = attr_dict [ 'cleanup_command' ] . default , elevation_required = attr_dict [ 'elevation_required' ] . default , steps = attr_dict [ 'steps' ] . default ): self . name = name self . command = command self . cleanup_command = cleanup_command self . elevation_required = elevation_required self . steps = steps","title":"__init__()"},{"location":"models-ref/#atomic_operator.atomic.atomictest.AtomicTest","text":"A single Atomic test object structure Returns: Type Description AtomicTest A single Atomic test object","title":"AtomicTest"},{"location":"models-ref/#atomic_operator.atomic.atomictest.AtomicTest.__init__","text":"Method generated by attrs for class AtomicTest. Source code in atomic_operator/atomic/atomictest.py def __init__ ( self , name , description , supported_platforms , auto_generated_guid , executor , input_arguments = attr_dict [ 'input_arguments' ] . default , dependency_executor_name = attr_dict [ 'dependency_executor_name' ] . default , dependencies = attr_dict [ 'dependencies' ] . default ): self . name = name self . description = description self . supported_platforms = supported_platforms self . auto_generated_guid = auto_generated_guid self . executor = executor self . input_arguments = input_arguments self . dependency_executor_name = dependency_executor_name self . dependencies = dependencies self . __attrs_post_init__ ()","title":"__init__()"},{"location":"models-ref/#atomic_operator.atomic.atomictest.AtomicTestInput","text":"","title":"AtomicTestInput"},{"location":"models-ref/#atomic_operator.atomic.atomictest.AtomicTestInput.__init__","text":"Method generated by attrs for class AtomicTestInput. Source code in atomic_operator/atomic/atomictest.py def __init__ ( self , name , description , type , default , value = attr_dict [ 'value' ] . default , source = attr_dict [ 'source' ] . default , destination = attr_dict [ 'destination' ] . default ): self . name = name self . description = description self . type = type self . default = default self . value = value self . source = source self . destination = destination","title":"__init__()"},{"location":"running-tests-command-line/","text":"Running Atomic Tests In order to run tests using atomic-operator you must have one or more atomic tests . Selecting Tests to Run By default, atomic-operator will run all known tests within the provided directory. If you would like to specify specific tests then you must provide them as a list as input. Please note that techniques passed in but be separated by a , and NO spaces. atomic-operator run --atomics-path \"~/_Swimlane/atomic-red-team\" --techniques T1560.002,T1560.001 Selecting Individual Atomic Tests You can select individual tests when you provide one or more specific techniques. For example running the following on the command line: atomic-operator run --techniques T1564.001 --select_tests Will prompt the user with a selection list of tests associated with that technique. A user can select one or more tests by using the space bar to highlight the desired test: Select Test(s) for Technique T1564.001 (Hide Artifacts: Hidden Files and Directories) * Create a hidden file in a hidden directory (61a782e5-9a19-40b5-8ba4-69a4b9f3d7be) Mac Hidden file (cddb9098-3b47-4e01-9d3b-6f5f323288a9) Create Windows System File with Attrib (f70974c8-c094-4574-b542-2c545af95a32) Create Windows Hidden File with Attrib (dadb792e-4358-4d8d-9207-b771faa0daa5) Hidden files (3b7015f2-3144-4205-b799-b05580621379) Hide a Directory (b115ecaf-3b24-4ed2-aefe-2fcb9db913d3) Show all hidden files (9a1ec7da-b892-449f-ad68-67066d04380c) Checking Dependencies There is an optional paramater that determines if atomic-operator should check dependencies or not. By default we do not check dependenicies but if set to True we will. atomic-operator run --atomics-path \"~/_Swimlane/atomic-red-team\" --techniques T1560.002,T1560.001 --check_dependicies True Checking of dependencies means we will run any defined prereq_command defined within the Atomic test. Get Prerequisities Another optional paramater deteremines if we retrieve or run any get_prereq_command values defined within the Atomic test. atomic-operator run --atomics-path \"~/_Swimlane/atomic-red-team\" --techniques T1560.002,T1560.001 --check_dependencies True --get_prereq_command True Setting this value to True means we will run that command but only if check_dependencies is set to True as well. Cleanup This optional parameter is by default set to False but if set to True then we will run any cleanup_command values defined within an Atomic test. atomic-operator run --atomics-path \"~/_Swimlane/ atomic-red-team\" --techniques T1560.002,T1560.001 --cleanup True Command Timeout The command_timeout parameter tells atomic-operator the duration (in seconds) to run a command without exiting that process. atomic-operator run --atomics-path \"~/_Swimlane/atomic-red-team\" --techniques T1560.002,T1560.001 --command_timeout 40 This defaults to 20 seconds but you can specify another value if needed. Debug The debug parameter will show additional details about the Atomic and tests (e.g. descriptions, etc.). atomic-operator run --atomics-path \"~/_Swimlane/atomic-red-team\" --techniques T1560.002,T1560.001 --debug The default value is False and must be set to True to show this extra detail. Interactive Argument Inputs The prompt_for_input_args parameter will enable an interactive session and prompt you to enter arguments for any Atomic test(s) that require input arguments. You can simply provide a value or select to use the default defined within the Atomic test. atomic-operator run --atomics-path \"~/_Swimlane/atomic-red-team\" --techniques T1560.002,T1560.001 --prompt_for_input_args True The default value is False and must be set to True to prompt you for input values. kwargs If you choose not to set prompt_for_input_args to True then you can provide a dictionary of arguments in the kwargs input. This dictionary is only used for setting input argument values. For example, if you were running the Atomic test T1564.001 then would pass in a dictionary into the kwargs argument. Additional Input Arguments from Command Line If you do not want atomic-operator to prompt you for inputs you can simply run the following on the command line: atomic-operator run --atomics-path \"~/_Swimlane/atomic-red-team\" --techniques T1564.001 --kwargs '{\"filename\": \"myscript.py\"}'","title":"Running Tests on Command Line"},{"location":"running-tests-command-line/#running-atomic-tests","text":"In order to run tests using atomic-operator you must have one or more atomic tests .","title":"Running Atomic Tests"},{"location":"running-tests-command-line/#selecting-tests-to-run","text":"By default, atomic-operator will run all known tests within the provided directory. If you would like to specify specific tests then you must provide them as a list as input. Please note that techniques passed in but be separated by a , and NO spaces. atomic-operator run --atomics-path \"~/_Swimlane/atomic-red-team\" --techniques T1560.002,T1560.001","title":"Selecting Tests to Run"},{"location":"running-tests-command-line/#selecting-individual-atomic-tests","text":"You can select individual tests when you provide one or more specific techniques. For example running the following on the command line: atomic-operator run --techniques T1564.001 --select_tests Will prompt the user with a selection list of tests associated with that technique. A user can select one or more tests by using the space bar to highlight the desired test: Select Test(s) for Technique T1564.001 (Hide Artifacts: Hidden Files and Directories) * Create a hidden file in a hidden directory (61a782e5-9a19-40b5-8ba4-69a4b9f3d7be) Mac Hidden file (cddb9098-3b47-4e01-9d3b-6f5f323288a9) Create Windows System File with Attrib (f70974c8-c094-4574-b542-2c545af95a32) Create Windows Hidden File with Attrib (dadb792e-4358-4d8d-9207-b771faa0daa5) Hidden files (3b7015f2-3144-4205-b799-b05580621379) Hide a Directory (b115ecaf-3b24-4ed2-aefe-2fcb9db913d3) Show all hidden files (9a1ec7da-b892-449f-ad68-67066d04380c)","title":"Selecting Individual Atomic Tests"},{"location":"running-tests-command-line/#checking-dependencies","text":"There is an optional paramater that determines if atomic-operator should check dependencies or not. By default we do not check dependenicies but if set to True we will. atomic-operator run --atomics-path \"~/_Swimlane/atomic-red-team\" --techniques T1560.002,T1560.001 --check_dependicies True Checking of dependencies means we will run any defined prereq_command defined within the Atomic test.","title":"Checking Dependencies"},{"location":"running-tests-command-line/#get-prerequisities","text":"Another optional paramater deteremines if we retrieve or run any get_prereq_command values defined within the Atomic test. atomic-operator run --atomics-path \"~/_Swimlane/atomic-red-team\" --techniques T1560.002,T1560.001 --check_dependencies True --get_prereq_command True Setting this value to True means we will run that command but only if check_dependencies is set to True as well.","title":"Get Prerequisities"},{"location":"running-tests-command-line/#cleanup","text":"This optional parameter is by default set to False but if set to True then we will run any cleanup_command values defined within an Atomic test. atomic-operator run --atomics-path \"~/_Swimlane/ atomic-red-team\" --techniques T1560.002,T1560.001 --cleanup True","title":"Cleanup"},{"location":"running-tests-command-line/#command-timeout","text":"The command_timeout parameter tells atomic-operator the duration (in seconds) to run a command without exiting that process. atomic-operator run --atomics-path \"~/_Swimlane/atomic-red-team\" --techniques T1560.002,T1560.001 --command_timeout 40 This defaults to 20 seconds but you can specify another value if needed.","title":"Command Timeout"},{"location":"running-tests-command-line/#debug","text":"The debug parameter will show additional details about the Atomic and tests (e.g. descriptions, etc.). atomic-operator run --atomics-path \"~/_Swimlane/atomic-red-team\" --techniques T1560.002,T1560.001 --debug The default value is False and must be set to True to show this extra detail.","title":"Debug"},{"location":"running-tests-command-line/#interactive-argument-inputs","text":"The prompt_for_input_args parameter will enable an interactive session and prompt you to enter arguments for any Atomic test(s) that require input arguments. You can simply provide a value or select to use the default defined within the Atomic test. atomic-operator run --atomics-path \"~/_Swimlane/atomic-red-team\" --techniques T1560.002,T1560.001 --prompt_for_input_args True The default value is False and must be set to True to prompt you for input values.","title":"Interactive Argument Inputs"},{"location":"running-tests-command-line/#kwargs","text":"If you choose not to set prompt_for_input_args to True then you can provide a dictionary of arguments in the kwargs input. This dictionary is only used for setting input argument values. For example, if you were running the Atomic test T1564.001 then would pass in a dictionary into the kwargs argument.","title":"kwargs"},{"location":"running-tests-command-line/#additional-input-arguments-from-command-line","text":"If you do not want atomic-operator to prompt you for inputs you can simply run the following on the command line: atomic-operator run --atomics-path \"~/_Swimlane/atomic-red-team\" --techniques T1564.001 --kwargs '{\"filename\": \"myscript.py\"}'","title":"Additional Input Arguments from Command Line"},{"location":"running-tests-script/","text":"Running Atomic Tests In order to run tests using atomic-operator you must have one or more atomic tests . Selecting Tests to Run By default, atomic-operator will run all known tests within the provided directory. from atomic_operator import AtomicOperator art = AtomicOperator() print(art.run(atomics_path='my_local_folder/atomic-red-team')) If you would like to specify specific tests then you must provide them as a list as input. Please note that techniques passed in but be separated by a , and NO spaces. from atomic_operator import AtomicOperator art = AtomicOperator() print(art.run( techniques='T1560.002', 'T1560.001'], atomics_path='my_local_folder/atomic-red-team' )) Checking Dependencies There is an optional paramater that determines if atomic-operator should check dependencies or not. By default we do not check dependenicies but if set to True we will. art.run( atomics_path='my_local_folder/atomic-red-team', check_dependencies=True ) check_dependencies means we will run any defined prereq_command defined within the Atomic test. Get Prerequisities Another optional paramater deteremines if we retrieve or run any get_prereq_command values defined within the Atomic test. art.run( atomics_path='my_local_folder/atomic-red-team', check_dependencies=True, get_prereq_command=True, ) Setting this value to True means we will run that command but only if check_dependencies is set to True as well. Cleanup This optional parameter is by default set to False but if set to True then we will run any cleanup_command values defined within an Atomic test. art.run( atomics_path='my_local_folder/atomic-red-team', cleanup=True ) Command Timeout The command_timeout parameter tells atomic-operator the duration (in seconds) to run a command without exiting that process. art.run( atomics_path='my_local_folder/atomic-red-team', command_timeout=40 ) This defaults to 20 seconds but you can specify another value if needed. Debug The debug parameter will show additional details about the Atomic and tests (e.g. descriptions, etc.). art.run( atomics_path='my_local_folder/atomic-red-team', debug=True ) The default value is False and must be set to True to show this extra detail. Interactive Argument Inputs The prompt_for_input_args parameter will enable an interactive session and prompt you to enter arguments for any Atomic test(s) that require input arguments. You can simply provide a value or select to use the default defined within the Atomic test. art.run( atomics_path='my_local_folder/atomic-red-team', prompt_for_input_args=True ) The default value is False and must be set to True to prompt you for input values. kwargs If you choose not to set prompt_for_input_args to True then you can provide a dictionary of arguments in the kwargs input. This dictionary is only used for setting input argument values. For example, if you were running the Atomic test T1564.001 then would pass in a dictionary into the kwargs argument. If you do not want atomic-operator to prompt you for inputs you can simply run the following on the command line: inputs = { 'filename': 'myscript.py' } art.run( atomics_path='my_local_folder/atomic-red-team', prompt_for_input_args=False, **inputs )","title":"Running Tests via Scripts"},{"location":"running-tests-script/#running-atomic-tests","text":"In order to run tests using atomic-operator you must have one or more atomic tests .","title":"Running Atomic Tests"},{"location":"running-tests-script/#selecting-tests-to-run","text":"By default, atomic-operator will run all known tests within the provided directory. from atomic_operator import AtomicOperator art = AtomicOperator() print(art.run(atomics_path='my_local_folder/atomic-red-team')) If you would like to specify specific tests then you must provide them as a list as input. Please note that techniques passed in but be separated by a , and NO spaces. from atomic_operator import AtomicOperator art = AtomicOperator() print(art.run( techniques='T1560.002', 'T1560.001'], atomics_path='my_local_folder/atomic-red-team' ))","title":"Selecting Tests to Run"},{"location":"running-tests-script/#checking-dependencies","text":"There is an optional paramater that determines if atomic-operator should check dependencies or not. By default we do not check dependenicies but if set to True we will. art.run( atomics_path='my_local_folder/atomic-red-team', check_dependencies=True ) check_dependencies means we will run any defined prereq_command defined within the Atomic test.","title":"Checking Dependencies"},{"location":"running-tests-script/#get-prerequisities","text":"Another optional paramater deteremines if we retrieve or run any get_prereq_command values defined within the Atomic test. art.run( atomics_path='my_local_folder/atomic-red-team', check_dependencies=True, get_prereq_command=True, ) Setting this value to True means we will run that command but only if check_dependencies is set to True as well.","title":"Get Prerequisities"},{"location":"running-tests-script/#cleanup","text":"This optional parameter is by default set to False but if set to True then we will run any cleanup_command values defined within an Atomic test. art.run( atomics_path='my_local_folder/atomic-red-team', cleanup=True )","title":"Cleanup"},{"location":"running-tests-script/#command-timeout","text":"The command_timeout parameter tells atomic-operator the duration (in seconds) to run a command without exiting that process. art.run( atomics_path='my_local_folder/atomic-red-team', command_timeout=40 ) This defaults to 20 seconds but you can specify another value if needed.","title":"Command Timeout"},{"location":"running-tests-script/#debug","text":"The debug parameter will show additional details about the Atomic and tests (e.g. descriptions, etc.). art.run( atomics_path='my_local_folder/atomic-red-team', debug=True ) The default value is False and must be set to True to show this extra detail.","title":"Debug"},{"location":"running-tests-script/#interactive-argument-inputs","text":"The prompt_for_input_args parameter will enable an interactive session and prompt you to enter arguments for any Atomic test(s) that require input arguments. You can simply provide a value or select to use the default defined within the Atomic test. art.run( atomics_path='my_local_folder/atomic-red-team', prompt_for_input_args=True ) The default value is False and must be set to True to prompt you for input values.","title":"Interactive Argument Inputs"},{"location":"running-tests-script/#kwargs","text":"If you choose not to set prompt_for_input_args to True then you can provide a dictionary of arguments in the kwargs input. This dictionary is only used for setting input argument values. For example, if you were running the Atomic test T1564.001 then would pass in a dictionary into the kwargs argument. If you do not want atomic-operator to prompt you for inputs you can simply run the following on the command line: inputs = { 'filename': 'myscript.py' } art.run( atomics_path='my_local_folder/atomic-red-team', prompt_for_input_args=False, **inputs )","title":"kwargs"},{"location":"windows-remote/","text":"Running Tests Remotely On Windows NOTE: To use this on your remote Windows machines, you need to do the following: Run from an elevated PowerShell prompt winrm quickconfig (type yes) Enable-PSRemoting (type yes) # Set start mode to automatic Set-Service WinRM -StartMode Automatic # Verify start mode and state - it should be running Get-WmiObject -Class win32_service | Where-Object {$_.name -like \"WinRM\"} Additionally you may need to specify the allowed host to remote into systems: # Trust hosts Set-Item 'WSMan:localhost\\client\\trustedhosts' -value * -Force NOTE: don't use the * for the value parameter in production - specify your Swimlane instance IP # Verify trusted hosts configuration Get-Item WSMan:\\localhost\\Client\\TrustedHosts Additional Troubleshooting #If you receive a timeout error or something like that, check and make sure that your remote Windows host network is set to Private and NOT public. You can change it using the following: # Get Network Profile Get-NetConnectionProfile # if the NetworkCategory is set to Public then run the following to set it to Private Set-NetConnectionProfile -InterfaceAlias Ethernet0 -NetworkCategory Private # try it again","title":"Running Tests Remotely On Windows"},{"location":"windows-remote/#running-tests-remotely-on-windows","text":"NOTE: To use this on your remote Windows machines, you need to do the following: Run from an elevated PowerShell prompt winrm quickconfig (type yes) Enable-PSRemoting (type yes) # Set start mode to automatic Set-Service WinRM -StartMode Automatic # Verify start mode and state - it should be running Get-WmiObject -Class win32_service | Where-Object {$_.name -like \"WinRM\"} Additionally you may need to specify the allowed host to remote into systems: # Trust hosts Set-Item 'WSMan:localhost\\client\\trustedhosts' -value * -Force NOTE: don't use the * for the value parameter in production - specify your Swimlane instance IP # Verify trusted hosts configuration Get-Item WSMan:\\localhost\\Client\\TrustedHosts Additional Troubleshooting #If you receive a timeout error or something like that, check and make sure that your remote Windows host network is set to Private and NOT public. You can change it using the following: # Get Network Profile Get-NetConnectionProfile # if the NetworkCategory is set to Public then run the following to set it to Private Set-NetConnectionProfile -InterfaceAlias Ethernet0 -NetworkCategory Private # try it again","title":"Running Tests Remotely On Windows"}]}